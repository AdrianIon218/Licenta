import{j as l,a as s,r as n,V as b,F as _,u as k,_ as F}from"./index-efcf9db2.js";import{a as W}from"./axios-707ed124.js";import{I as N}from"./commonInterfaces-83a6a30d.js";import{N as H,a as U}from"./Notfication-d5237bdd.js";function $({progressStatus:e}){return l("div",{className:"progress-bar__box",children:[s("div",{className:"progress-bar__loading",style:{width:`${e}%`}}),s("div",{className:"progress-bar__grid-half"})]})}function S(e){const[t,c]=n.useState(0),r=n.useContext(b),i=e.sentence.length,m=i<8?i*190:i>20?i*120:i*170;return s("button",{className:"play-btn",onClick:()=>{c(a=>a===0?(r==null||r.readTextWithVoice(e.sentence),setTimeout(()=>{c(0)},m),1):a)},children:s("i",{className:`${t===0?"fa fa-play":"fa fa-pause"}`})})}function v(e){const t=n.useRef(null),[c,r]=n.useState(!1),i=m=>{var h;c||((h=t.current)==null||h.classList.add("word__container--fade-out"),setTimeout(()=>m(),300),r(!0))};return l("div",{className:"flex-column--centered word__container",ref:t,children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h3",{className:"u-center-text",children:e.wordName}),l("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),l("h5",{className:"u-center-text",children:["Ex : ",e.example," "]}),s(S,{sentence:e.wordName}),l("div",{className:"arrow-ctn",children:[e.previousWord!==void 0&&s("i",{className:"fas fa-chevron-circle-left",onClick:()=>i(e.previousWord)}),e.nextWord!==void 0&&s("i",{className:"fas fa-chevron-circle-right arrow-right",onClick:()=>i(e.nextWord)})]})]})}function O(e){const[t,c]=n.useState(0),r=e.unkwonWords.length,[i,m]=n.useState(0);n.useEffect(()=>{e.setProgressBar(i)},[i]);const h=u=>{m(f=>f+50/r),c(u)},a=u=>{m(f=>f-50/r),c(u)},o=()=>{m(u=>u+50/r),e.toExecises()},d=n.useMemo(()=>e.unkwonWords.map((u,f)=>f===0?n.createElement(v,{...u,key:f,nextWord:()=>h(f+1)}):f===r-1?n.createElement(v,{...u,key:f,previousWord:()=>a(f-1),nextWord:o}):n.createElement(v,{...u,key:f,previousWord:()=>a(f-1),nextWord:()=>h(f+1)})),[e.unkwonWords]);return s("div",{children:d[t]})}function V(e){const t=n.useContext(b),c=e.textToLookFor.length>15?8:3;return s("button",{className:"play-btn",onClick:()=>{t.startRecord(c).then(i=>{i===e.textToLookFor?console.log("text match"):console.log(i)})},children:s("i",{className:"fa fa-microphone"})})}function j(e){return l("div",{className:"flex-column--centered word__container",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h3",{className:"u-center-text",children:e.wordName}),l("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),s(V,{textToLookFor:e.wordName})]})}function D(e){return n.useContext(b),s("div",{children:s(j,{...e.unkwonWords[0]})})}const J=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;function T(e){let t=e.replace(J,"");return t=t.replace(/\s+/g," ").trim(),t}function X(e){const[t,c]=n.useState(0),r=n.useRef(null),i=T(e.wordName.toLowerCase()),m=o=>{o.preventDefault(),T(r.current.value.toLowerCase())===i?e.correctAnswear():(r.current.value="",c(u=>u+1),e.wrongAnswear())},h=o=>{r.current.value.length<i.length&&(r.current.value+=o,r.current.focus())},a=n.useMemo(()=>["ä","ö","ü","ß"].map((o,d)=>s("button",{type:"button",onClick:()=>h(o),children:o},d)),[]);return l(_,{children:[l("div",{className:"info",children:[s("i",{className:"fa fa-lightbulb-o"}),s("span",{children:l("ul",{children:[s("li",{children:"Nu este nevoie să folosești majuscule ."}),s("li",{children:"Nu folosi semne de punctuație ."})]})})]}),t===2&&s("button",{className:"skip-btn",onClick:e.skipExercise,children:"Skip"}),l("div",{className:"flex-column--centered word__container",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),s(S,{sentence:e.example}),l("form",{onSubmit:m,className:"flex-column--centered write_word__form",children:[s("input",{type:"text",className:"flex-element u-center-text",maxLength:i.length,minLength:2,ref:r,autoFocus:!0}),s("div",{className:"flex-element u-center-text umlouts-ctn ",children:a}),l("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})]})}function z(e){const[t,c]=n.useState(""),r=n.useMemo(()=>{let a=e.wordNames.filter(o=>o!==e.wordName).sort((o,d)=>.5-Math.random()).slice(0,3).concat(e.wordName);return a=a.sort((o,d)=>.5-Math.random()),a},[e.wordNames]),i=a=>{c(a.target.value)},m=n.useMemo(()=>r.map((a,o)=>{const d=`choice-${o}`;return l("div",{className:"choice-ctn",children:[s("label",{htmlFor:d,className:t===a?"choice--checked":"",children:a}),s("input",{type:"checkbox",id:d,name:"choice",value:a,hidden:!0,onChange:i})]},o)}),[r,t]),h=a=>{a.preventDefault(),t===e.wordName?e.correctAnswear():t!==""&&e.wrongAnswear()};return l("div",{className:"flex-column--centered multiple-choice-ex",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),l("form",{className:"flex-column--centered",children:[s("div",{className:"multiple-choices-ctn",children:m}),l("button",{className:"submitBtn u-center-text",onClick:h,children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})}function G(e){const[t,c]=n.useState(""),r=n.useMemo(()=>{let a=e.wordsTranslation.filter(o=>o!==e.translation).sort((o,d)=>.5-Math.random()).slice(0,3).concat(e.translation);return a=a.sort((o,d)=>.5-Math.random()),a},[e.wordsTranslation]),i=a=>{c(a.target.value)},m=n.useMemo(()=>r.map((a,o)=>{const d=`choice-${o}`;return l("div",{className:"choice-ctn",children:[s("label",{htmlFor:d,className:t===a?"choice--checked":"",children:a}),s("input",{type:"checkbox",id:d,name:"choice",value:a,hidden:!0,onChange:i})]},o)}),[r,t]),h=a=>{a.preventDefault(),t===e.translation?e.correctAnswear():t!==""&&e.wrongAnswear()};return l("div",{className:"flex-column--centered multiple-choice-ex",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.wordName}),s(S,{sentence:e.wordName}),l("form",{className:"flex-column--centered",children:[s("div",{className:"multiple-choices-ctn",children:m}),l("button",{className:"submitBtn u-center-text",onClick:h,children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})}function q(e){const[t,c]=n.useReducer(h,{progressBar:50,score:0,wordIndex:0}),[r,i]=n.useState(!1),m=e.unkwonWords.length;function h(o,d){const u=50/e.unkwonWords.length;switch(d.type){case 0:return e.setProgressBar(o.progressBar+u),{progressBar:o.progressBar+u,score:o.score+1,wordIndex:o.wordIndex+1};case 1:return{...o,score:o.score-1};case 2:return e.setProgressBar(o.progressBar+u),{progressBar:o.progressBar+u,score:o.score-1,wordIndex:o.wordIndex+1};default:return o}}n.useEffect(()=>{e.unkwonWords.sort((o,d)=>.5-Math.random())},[]);const a=n.useMemo(()=>{const o=e.unkwonWords.map(f=>f.wordName),d=e.unkwonWords.map(f=>f.translation),u={correctAnswear:()=>{c({type:0}),i(!1)},wrongAnswear:()=>{c({type:1}),i(!0)}};return e.unkwonWords.map((f,w)=>{const g=w%3;return g===1?s(X,{...f,...u,skipExercise:()=>{c({type:2}),i(!1)}},w):g===0?s(z,{...f,...u,wordNames:o},w):s(G,{...f,...u,wordsTranslation:d},w)})},[e.unkwonWords]);return n.useEffect(()=>{if(t.wordIndex===e.unkwonWords.length){const o=t.score<=m/3?N.STAR_1:t.score<=m/2?N.STAR_2:N.STAR_3;e.onFinish(o)}},[t.wordIndex]),l("div",{className:"new_words_ex",children:[r&&s(H,{message:"Răspuns greșit !",type:U.ERROR,deleteNotification:()=>i(!1)}),t.wordIndex<e.unkwonWords.length&&a[t.wordIndex]]})}function K(e){const t=k();return n.useEffect(()=>{const c=localStorage.getItem("userAccount"),r=sessionStorage.getItem("lessonId");sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),sessionStorage.removeItem("lessonType"),c?W.post("http://localhost:5000/lessons/addProgress",{email:c,lessonId:r,status:e.statusLesson}).then(i=>{sessionStorage.removeItem("lessonId")}):sessionStorage.removeItem("lessonId")},[]),l("div",{className:"flex-column--centered",children:[s("h3",{className:"heading-secondary u-center-text",children:"Lecție terminată"}),l("div",{className:"result-stars",children:[s("i",{className:`fa fa-star ${e.statusLesson!==N.NO_PROGRESS&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson===N.STAR_3&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson>N.STAR_1&&"course-status--checked"}`})]}),s("button",{className:"btn-gradient-cyan",onClick:()=>t(-1),children:" Înapoi la lecții"})]})}const Q=n.lazy(()=>F(()=>import("./StartView-332bfa3d.js"),["assets/StartView-332bfa3d.js","assets/index-efcf9db2.js","assets/index-2d981070.css"]));function Y(e){const[t,c]=n.useState(0),[r,i]=n.useState([]),[m,h]=n.useState(),[a,o]=n.useState(N.NO_PROGRESS),d=sessionStorage.getItem("lessonType"),u=g=>{e.triggerTransition(),setTimeout(()=>c(g),450)},f=g=>{const x=[];return W.post("http://localhost:5000/lessons/getWords",{moduleId:g}).then(I=>(I.data.forEach(L=>{const{id:C,word:R,translation:E,example:B,moduleId:y}=L,A=new Uint8Array(L.image.data),M=new Blob([A],{type:"application/octet-stream"}),P=URL.createObjectURL(M);x.push({id:C,wordName:R.trim(),translation:E.trim(),example:B,moduleId:y,imageURL:P})}),x))};n.useEffect(()=>{(d==="new_words"||d==="pronunciation"||d==="test")&&f(e.moduleId).then(g=>{g.sort((x,I)=>.5-Math.random()),i(g)})},[e.moduleId]),n.useEffect(()=>{if(d==="new_words"){h(s(O,{toExecises:()=>u(2),unkwonWords:r,setProgressBar:e.setProgressBar}));return}if(d==="pronunciation"){h(s(D,{toExecises:()=>u(2),unkwonWords:r}));return}},[r]);const w=g=>{o(g),u(3)};return n.useEffect(()=>{t===2&&h(s(q,{unkwonWords:r,setProgressBar:e.setProgressBar,onFinish:w})),t===3&&h(s(K,{statusLesson:a}))},[t,a]),l(_,{children:[t===0&&s(Q,{title:e.lessonTitle,startClickHandler:()=>u(1)}),(t===1||t===2||t===3)&&m]})}function Z(e){const[t,c]=n.useState(!1),r=k(),i=n.useCallback(()=>{sessionStorage.removeItem("lessonType"),sessionStorage.removeItem("lessonId"),sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),c(!0),setTimeout(()=>r(-1),410)},[]),m=n.useCallback(()=>{c(!0),setTimeout(()=>e.closeBk(),350)},[]);return s("div",{className:`exit_message__blackdrop ${t&&"exit_message__blackdrop--close"}`,children:l("div",{className:"exit_message__box flex-column--centered",children:[s("div",{className:"btn_exit_ctn",children:s("div",{className:"btn_exit",onClick:m,children:" × "})}),s("h3",{children:" Sigur dorești să închizi lecția ? "}),l("div",{className:"flex-row--centered",children:[s("div",{className:"btn btn--white lesson-btn",onClick:i,children:" Da "}),s("div",{className:"btn btn--blue lesson-btn",onClick:m,children:" Nu "})]})]})})}function p(){const[e,t]=n.useState(!1);return l(_,{children:[e&&s(Z,{closeBk:()=>t(!1)}),s("div",{className:"lesson__exit",children:s("button",{className:"lesson__exit__btn",onClick:()=>{t(!0)},children:"×"})})]})}function ee(e,t){const c=n.useRef(null);return n.useImperativeHandle(t,()=>({trigger:()=>{c.current.classList.add("lesson-transition--animated")}}),[]),s("div",{className:"lesson-transition",onAnimationEnd:()=>{c.current.classList.remove("lesson-transition--animated")},ref:c})}const se=n.forwardRef(ee);function ae(){const[e,t]=n.useState({lessonId:-1,moduleId:-1,lessonTitle:""}),[c,r]=n.useState(0),i=k(),m=n.useRef({trigger:()=>{}});n.useEffect(()=>{const o=sessionStorage.getItem("lessonId"),d=sessionStorage.getItem("moduleId"),u=sessionStorage.getItem("lessonTitle");o&&d&&u?t({lessonId:+o,moduleId:+d,lessonTitle:u}):i("/Licenta/PageNotFound")},[]);const h=n.useCallback(o=>{o>=0&&o<=100&&r(o)},[]),a=n.useCallback(()=>{m.current.trigger()},[]);return s("div",{className:"lesson-section-ctn",children:l("section",{className:"lesson-section",children:[l("div",{className:"lesson-ctn",children:[e.lessonId>=0&&s(Y,{...e,setProgressBar:h,triggerTransition:a}),s(se,{ref:m})]}),s("div",{className:"lesson__progress-bar",children:s($,{progressStatus:c})}),s(p,{})]})})}export{ae as default};
