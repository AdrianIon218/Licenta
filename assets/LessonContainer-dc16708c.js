import{j as d,a as s,r as n,V as W,F as _,u as v,_ as O}from"./index-85730b2f.js";import{a as E}from"./axios-707ed124.js";import{I as w}from"./commonInterfaces-83a6a30d.js";import{N as U,a as $}from"./Notfication-da688392.js";function j({progressStatus:e}){return d("div",{className:"progress-bar__box",children:[s("div",{className:"progress-bar__loading",style:{width:`${e}%`}}),s("div",{className:"progress-bar__grid-half"})]})}function T(e){const[t,r]=n.useState(0),o=n.useContext(W),a=e.sentence.length,u=a<8?a*190:a>20?a*120:a*170;return s("button",{className:"play-btn",onClick:()=>{r(f=>f===0?(o==null||o.readTextWithVoice(e.sentence),setTimeout(()=>{r(0)},u),1):f)},children:s("i",{className:`${t===0?"fa fa-play":"fa fa-pause"}`})})}function x(e){const t=n.useRef(null),[r,o]=n.useState(!1),a=u=>{var i;r||((i=t.current)==null||i.classList.add("word__container--fade-out"),setTimeout(()=>u(),300),o(!0))};return d("div",{className:"flex-column--centered word__container",ref:t,children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h3",{className:"u-center-text",children:e.wordName}),d("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),d("h5",{className:"u-center-text",children:["Ex : ",e.example," "]}),s(T,{sentence:e.wordName}),d("div",{className:"arrow-ctn",children:[e.previousWord!==void 0&&s("i",{className:"fas fa-chevron-circle-left",onClick:()=>a(e.previousWord)}),e.nextWord!==void 0&&s("i",{className:"fas fa-chevron-circle-right arrow-right",onClick:()=>a(e.nextWord)})]})]})}function V(e){const[t,r]=n.useState(0),o=e.unkwonWords.length,[a,u]=n.useState(0);n.useEffect(()=>{e.setProgressBar(a)},[a]);const i=l=>{u(g=>g+50/o),r(l)},f=l=>{u(g=>g-50/o),r(l)},c=()=>{u(l=>l+50/o),e.toExecises()},m=n.useMemo(()=>e.unkwonWords.map((l,g)=>g===0?n.createElement(x,{...l,key:g,nextWord:()=>i(g+1)}):g===o-1?n.createElement(x,{...l,key:g,previousWord:()=>f(g-1),nextWord:c}):n.createElement(x,{...l,key:g,previousWord:()=>f(g-1),nextWord:()=>i(g+1)})),[e.unkwonWords]);return s("div",{children:m[t]})}function F(e){return n.useContext(W),s("div",{})}const D=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;function b(e){let t=e.replace(D,"");return t=t.replace(/\s+/g," ").trim(),t}function k(e){const t=n.useRef(null),r=b(e.wordName.toLowerCase()),o=i=>{i.preventDefault(),b(t.current.value.toLowerCase())===r?e.correctAnswear():(t.current.value="",e.wrongAnswear())},a=i=>{t.current.value.length<r.length&&(t.current.value+=i,t.current.focus())},u=n.useMemo(()=>["ä","ö","ü","ß"].map((i,f)=>s("button",{type:"button",onClick:()=>a(i),children:i},f)),[]);return d(_,{children:[d("div",{className:"info",children:[s("i",{className:"fa fa-lightbulb-o"}),s("span",{children:d("ul",{children:[s("li",{children:"Nu este nevoie să folosești majuscule ."}),s("li",{children:"Nu folosi semne de punctuație ."})]})})]}),d("div",{className:"flex-column--centered word__container",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),s(T,{sentence:e.example}),d("form",{onSubmit:o,className:"flex-column--centered write_word__form",children:[s("input",{type:"text",className:"flex-element u-center-text",maxLength:r.length,ref:t,autoFocus:!0}),s("div",{className:"flex-element u-center-text umlouts-ctn ",children:u}),d("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})]})}function J(e){const[t,r]=n.useReducer(i,{progressBar:50,score:0,wordIndex:0}),[o,a]=n.useState(!1),u=e.unkwonWords.length;function i(c,m){const l=50/e.unkwonWords.length;switch(m.type){case 0:return e.setProgressBar(c.progressBar+l),{progressBar:c.progressBar+l,score:c.score+1,wordIndex:c.wordIndex+1};case 1:return{...c,score:c.score-1};default:return c}}n.useEffect(()=>{e.unkwonWords.sort((c,m)=>.5-Math.random())},[]);const f=n.useMemo(()=>e.unkwonWords.map((c,m)=>m%3===1?s(k,{...c,correctAnswear:()=>r({type:0}),wrongAnswear:()=>{r({type:1}),a(!0)}},m):s(k,{...c,correctAnswear:()=>r({type:0}),wrongAnswear:()=>{r({type:1}),a(!0)}},m)),[e.unkwonWords]);return n.useEffect(()=>{if(t.wordIndex===e.unkwonWords.length){const c=t.score<=u/3?w.STAR_1:t.score<=u/2?w.STAR_2:w.STAR_3;console.log(c),e.onFinish(c)}},[t.wordIndex]),d("div",{className:"new_words_ex",children:[o&&s(U,{message:"Răspuns greșit !",type:$.ERROR,deleteNotification:()=>a(!1)}),t.wordIndex<e.unkwonWords.length&&f[t.wordIndex]]})}function X(e){const t=v();return n.useEffect(()=>{const r=localStorage.getItem("userAccount"),o=sessionStorage.getItem("lessonId");sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),sessionStorage.removeItem("lessonType"),r?E.post("http://localhost:5000/lessons/addProgress",{email:r,lessonId:o,status:e.statusLesson}).then(a=>{console.log(a),sessionStorage.removeItem("lessonId")}):sessionStorage.removeItem("lessonId")},[]),d("div",{className:"flex-column--centered",children:[s("h3",{className:"heading-secondary u-center-text",children:"Lecție terminată"}),d("div",{className:"result-stars",children:[s("i",{className:`fa fa-star ${e.statusLesson!==w.NO_PROGRESS&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson===w.STAR_3&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson>w.STAR_1&&"course-status--checked"}`})]}),s("button",{className:"btn-gradient-cyan",onClick:()=>t(-1),children:" Înapoi la lecții"})]})}const z=n.lazy(()=>O(()=>import("./StartView-f474be71.js"),["assets/StartView-f474be71.js","assets/index-85730b2f.js","assets/index-86988383.css"]));function G(e){const[t,r]=n.useState(0),[o,a]=n.useState([]),[u,i]=n.useState(),[f,c]=n.useState(w.NO_PROGRESS),m=sessionStorage.getItem("lessonType"),l=h=>{e.triggerTransition(),setTimeout(()=>r(h),450)},g=h=>{const N=[];return E.post("http://localhost:5000/lessons/getWords",{moduleId:h}).then(I=>(I.data.forEach(S=>{const{id:R,word:y,translation:C,example:A,moduleId:B}=S,P=new Uint8Array(S.image.data),M=new Blob([P],{type:"application/octet-stream"}),H=URL.createObjectURL(M);N.push({id:R,wordName:y.trim(),translation:C.trim(),example:A,moduleId:B,imageURL:H})}),N))};n.useEffect(()=>{(m==="new_words"||m==="pronunciation"||m==="test")&&g(e.moduleId).then(h=>{h.sort((N,I)=>.5-Math.random()),a(h)})},[e.moduleId]),n.useEffect(()=>{if(m==="new_words"){i(s(V,{toExecises:()=>l(2),unkwonWords:o,setProgressBar:e.setProgressBar}));return}if(m==="pronunciation"){i(s(F,{toExecises:()=>l(2),unkwonWords:o}));return}},[o]);const L=h=>{c(h),l(3)};return n.useEffect(()=>{t===2&&i(s(J,{unkwonWords:o,setProgressBar:e.setProgressBar,onFinish:L})),t===3&&i(s(X,{statusLesson:f}))},[t,f]),d(_,{children:[t===0&&s(z,{title:e.lessonTitle,startClickHandler:()=>l(1)}),(t===1||t===2||t===3)&&u]})}function p(e){const[t,r]=n.useState(!1),o=v(),a=n.useCallback(()=>{sessionStorage.removeItem("lessonType"),sessionStorage.removeItem("lessonId"),sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),r(!0),setTimeout(()=>o(-1),410)},[]),u=n.useCallback(()=>{r(!0),setTimeout(()=>e.closeBk(),350)},[]);return s("div",{className:`exit_message__blackdrop ${t&&"exit_message__blackdrop--close"}`,children:d("div",{className:"exit_message__box flex-column--centered",children:[s("div",{className:"btn_exit_ctn",children:s("div",{className:"btn_exit",onClick:u,children:" × "})}),s("h3",{children:" Sigur dorești să închizi lecția ? "}),d("div",{className:"flex-row--centered",children:[s("div",{className:"btn btn--white lesson-btn",onClick:a,children:" Da "}),s("div",{className:"btn btn--blue lesson-btn",onClick:u,children:" Nu "})]})]})})}function q(){const[e,t]=n.useState(!1);return d(_,{children:[e&&s(p,{closeBk:()=>t(!1)}),s("div",{className:"lesson__exit",children:s("button",{className:"lesson__exit__btn",onClick:()=>{t(!0)},children:"×"})})]})}function K(e,t){const r=n.useRef(null);return n.useImperativeHandle(t,()=>({trigger:()=>{r.current.classList.add("lesson-transition--animated")}}),[]),s("div",{className:"lesson-transition",onAnimationEnd:()=>{r.current.classList.remove("lesson-transition--animated")},ref:r})}const Q=n.forwardRef(K);function te(){const[e,t]=n.useState({lessonId:-1,moduleId:-1,lessonTitle:""}),[r,o]=n.useState(0),a=v(),u=n.useRef({trigger:()=>{}});n.useEffect(()=>{const c=sessionStorage.getItem("lessonId"),m=sessionStorage.getItem("moduleId"),l=sessionStorage.getItem("lessonTitle");c&&m&&l?t({lessonId:+c,moduleId:+m,lessonTitle:l}):a("/Licenta/PageNotFound")},[]);const i=n.useCallback(c=>{c>=0&&c<=100&&o(c)},[]),f=n.useCallback(()=>{u.current.trigger()},[]);return d("section",{className:"lesson-section",children:[d("div",{className:"lesson-ctn",children:[e.lessonId>=0&&s(G,{...e,setProgressBar:i,triggerTransition:f}),s(Q,{ref:u})]}),s("div",{className:"lesson__progress-bar",children:s(j,{progressStatus:r})}),s(q,{})]})}export{te as default};
