import{j as m,a as s,r as n,V as b,F as w,_ as R,u as k}from"./index-e340eec1.js";import{a as P}from"./axios-707ed124.js";import{N as A,a as M}from"./Notfication-2080fcb7.js";function H({progressStatus:e}){return m("div",{className:"progress-bar__box",children:[s("div",{className:"progress-bar__loading",style:{width:`${e}%`}}),s("div",{className:"progress-bar__grid-half"})]})}function I(e){const[t,o]=n.useState(0),a=n.useContext(b),c=e.sentence.length,d=c<8?c*190:c>20?c*120:c*170;return s("button",{className:"play-btn",onClick:()=>{o(r=>r===0?(a==null||a.readTextWithVoice(e.sentence),setTimeout(()=>{o(0)},d),1):r)},children:s("i",{className:`${t===0?"fa fa-play":"fa fa-pause"}`})})}function h(e){const t=n.useRef(null),[o,a]=n.useState(!1),c=d=>{var i;o||((i=t.current)==null||i.classList.add("word__container--fade-out"),setTimeout(()=>d(),300),a(!0))};return m("div",{className:"flex-column--centered word__container",ref:t,children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h3",{className:"u-center-text",children:e.wordName}),m("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),m("h5",{className:"u-center-text",children:["Ex : ",e.example," "]}),s(I,{sentence:e.wordName}),m("div",{className:"arrow-ctn",children:[e.previousWord!==void 0&&s("i",{className:"fas fa-chevron-circle-left",onClick:()=>c(e.previousWord)}),e.nextWord!==void 0&&s("i",{className:"fas fa-chevron-circle-right arrow-right",onClick:()=>c(e.nextWord)})]})]})}function U(e){const[t,o]=n.useState(0),a=e.unkwonWords.length,[c,d]=n.useState(0);n.useEffect(()=>{e.setProgressBar(c)},[c]);const i=u=>{d(f=>f+50/a),o(u)},r=u=>{d(f=>f-50/a),o(u)},l=()=>{d(u=>u+50/a),e.toExecises()},g=n.useMemo(()=>e.unkwonWords.map((u,f)=>f===0?n.createElement(h,{...u,key:f,nextWord:()=>i(f+1)}):f===a-1?n.createElement(h,{...u,key:f,previousWord:()=>r(f-1),nextWord:l}):n.createElement(h,{...u,key:f,previousWord:()=>r(f-1),nextWord:()=>i(f+1)})),[e.unkwonWords]);return s("div",{children:g[t]})}function j(e){return n.useContext(b),s("div",{})}const V=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;function _(e){let t=e.replace(V,"");return t=t.replace(/\s+/g," ").trim(),t}function v(e){const t=n.useRef(null),o=_(e.wordName.toLowerCase()),a=i=>{i.preventDefault(),_(t.current.value.toLowerCase())===o?e.correctAnswear():(t.current.value="",e.wrongAnswear())},c=i=>{t.current.value.length<o.length&&(t.current.value+=i,t.current.focus())},d=n.useMemo(()=>["ä","ö","ü","ß"].map((i,r)=>s("button",{type:"button",onClick:()=>c(i),children:i},r)),[]);return m(w,{children:[m("div",{className:"info",children:[s("i",{className:"fa fa-lightbulb-o"}),s("span",{children:m("ul",{children:[s("li",{children:"Nu este nevoie să folosești majuscule ."}),s("li",{children:"Nu folosi semne de punctuație ."})]})})]}),m("div",{className:"flex-column--centered word__container",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),s(I,{sentence:e.example}),m("form",{onSubmit:a,className:"flex-column--centered write_word__form",children:[s("input",{type:"text",className:"flex-element u-center-text",maxLength:o.length,ref:t}),s("div",{className:"flex-element u-center-text umlouts-ctn ",children:d}),m("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})]})}function F(e){const[t,o]=n.useReducer(d,{progressBar:50,score:0,wordIndex:0}),[a,c]=n.useState(!1);function d(r,l){const g=50/e.unkwonWords.length;switch(l.type){case 0:return e.setProgressBar(r.progressBar+g),{progressBar:r.progressBar+g,score:r.score+1,wordIndex:r.wordIndex+1};case 1:return{...r,score:r.score-1};default:return r}}n.useEffect(()=>{e.unkwonWords.sort((r,l)=>.5-Math.random())},[]);const i=n.useMemo(()=>e.unkwonWords.map((r,l)=>l%3===1?s(v,{...r,correctAnswear:()=>o({type:0}),wrongAnswear:()=>{o({type:1}),c(!0)}},l):s(v,{...r,correctAnswear:()=>o({type:0}),wrongAnswear:()=>{o({type:1}),c(!0)}},l)),[e.unkwonWords]);return n.useEffect(()=>{t.wordIndex===e.unkwonWords.length&&e.onFinish()},[t.wordIndex]),m("div",{className:"new_words_ex",children:[a&&s(A,{message:"Răspuns greșit !",type:M.ERROR,deleteNotification:()=>c(!1)}),t.wordIndex<e.unkwonWords.length&&i[t.wordIndex]]})}const O=n.lazy(()=>R(()=>import("./StartView-12582963.js"),["assets/StartView-12582963.js","assets/index-e340eec1.js","assets/index-5d8fcacc.css"]));function $(e){const[t,o]=n.useState(0),[a,c]=n.useState([]),[d,i]=n.useState(),r=sessionStorage.getItem("lessonType"),l=u=>{e.triggerTransition(),setTimeout(()=>o(u),450)},g=u=>{const f=[];return P.post("http://localhost:5000/lessons/getWords",{moduleId:u}).then(x=>(x.data.forEach(N=>{const{id:W,word:S,translation:E,example:C,moduleId:T}=N,y=new Uint8Array(N.image.data),L=new Blob([y],{type:"application/octet-stream"}),B=URL.createObjectURL(L);f.push({id:W,wordName:S.trim(),translation:E.trim(),example:C,moduleId:T,imageURL:B})}),f))};return n.useEffect(()=>{(r==="new_words"||r==="pronunciation"||r==="test")&&g(e.moduleId).then(u=>{u.sort((f,x)=>.5-Math.random()),c(u)})},[e.moduleId]),n.useEffect(()=>{if(r==="new_words"){i(s(U,{toExecises:()=>l(2),unkwonWords:a,setProgressBar:e.setProgressBar}));return}if(r==="pronunciation"){i(s(j,{toExecises:()=>l(2),unkwonWords:a}));return}},[a]),n.useEffect(()=>{t===2&&i(s(F,{unkwonWords:a,setProgressBar:e.setProgressBar,onFinish:()=>l(3)})),t===3&&i(s("div",{children:"Finished"}))},[t]),m(w,{children:[t===0&&s(O,{title:e.lessonTitle,startClickHandler:()=>l(1)}),(t===1||t===2||t===3)&&d]})}function D(e){const[t,o]=n.useState(!1),a=k(),c=n.useCallback(()=>{sessionStorage.setItem("lessonId",""),sessionStorage.setItem("moduleId",""),sessionStorage.setItem("lessonTitle",""),o(!0),setTimeout(()=>a(-1),410)},[]),d=n.useCallback(()=>{o(!0),setTimeout(()=>e.closeBk(),350)},[]);return s("div",{className:`exit_message__blackdrop ${t&&"exit_message__blackdrop--close"}`,children:m("div",{className:"exit_message__box flex-column--centered",children:[s("div",{className:"btn_exit_ctn",children:s("div",{className:"btn_exit",onClick:d,children:" × "})}),s("h3",{children:" Sigur dorești să închizi lecția ? "}),m("div",{className:"flex-row--centered",children:[s("div",{className:"btn btn--white lesson-btn",onClick:c,children:" Da "}),s("div",{className:"btn btn--blue lesson-btn",onClick:d,children:" Nu "})]})]})})}function J(){const[e,t]=n.useState(!1);return m(w,{children:[e&&s(D,{closeBk:()=>t(!1)}),s("div",{className:"lesson__exit",children:s("button",{className:"lesson__exit__btn",onClick:()=>{t(!0)},children:"×"})})]})}function X(e,t){const o=n.useRef(null);return n.useImperativeHandle(t,()=>({trigger:()=>{o.current.classList.add("lesson-transition--animated")}}),[]),s("div",{className:"lesson-transition",onAnimationEnd:()=>{o.current.classList.remove("lesson-transition--animated")},ref:o})}const p=n.forwardRef(X);function K(){const[e,t]=n.useState({lessonId:-1,moduleId:-1,lessonTitle:""}),[o,a]=n.useState(0),c=k(),d=n.useRef({trigger:()=>{}});n.useEffect(()=>{const l=sessionStorage.getItem("lessonId"),g=sessionStorage.getItem("moduleId"),u=sessionStorage.getItem("lessonTitle");l&&g&&u?t({lessonId:+l,moduleId:+g,lessonTitle:u}):c("/Licenta/PageNotFound")},[]);const i=n.useCallback(l=>{l>=0&&l<=100&&a(l)},[]),r=n.useCallback(()=>{d.current.trigger()},[]);return m("section",{className:"lesson-section",children:[m("div",{className:"lesson-ctn",children:[e.lessonId>=0&&s($,{...e,setProgressBar:i,triggerTransition:r}),s(p,{ref:d})]}),s("div",{className:"lesson__progress-bar",children:s(H,{progressStatus:o})}),s(J,{})]})}export{K as default};
