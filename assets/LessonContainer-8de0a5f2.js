import{j as m,a as t,r as s,V as N,_ as R,F as v,u as b}from"./index-c3fe12c9.js";import{a as A}from"./axios-707ed124.js";function B({progressStatus:e}){return m("div",{className:"progress-bar__box",children:[t("div",{className:"progress-bar__loading",style:{width:`${e}%`}}),t("div",{className:"progress-bar__grid-half"})]})}function k(e){const[n,o]=s.useState(0),r=s.useContext(N);let i=null;const a=e.sentence.length,c=a<8?a*190:a*180;return t("button",{className:"play-btn",onClick:()=>{o(u=>u===0?(r==null||r.readTextWithVoice(e.sentence),i=setTimeout(()=>{o(0)},c),1):(clearTimeout(i),r==null||r.stopReadText(),0))},children:t("i",{className:`${n===0?"fa fa-play":"fa fa-pause"}`})})}function h(e){const n=s.useRef(null),[o,r]=s.useState(!1),i=a=>{var c;o||((c=n.current)==null||c.classList.add("word__container--fade-out"),setTimeout(()=>a(),300),r(!0))};return m("div",{className:"flex-column--centered word__container",ref:n,children:[t("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),t("h3",{className:"u-center-text",children:e.wordName}),m("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),m("h5",{className:"u-center-text",children:["Ex : ",e.example," "]}),t(k,{sentence:e.wordName}),m("div",{className:"arrow-ctn",children:[e.previousWord!==void 0&&t("i",{className:"fas fa-chevron-circle-left",onClick:()=>i(e.previousWord)}),e.nextWord!==void 0&&t("i",{className:"fas fa-chevron-circle-right arrow-right",onClick:()=>i(e.nextWord)})]})]})}function P(e){const[n,o]=s.useState(0),r=e.unkwonWords.length,[i,a]=s.useState(0);s.useEffect(()=>{e.setProgressBar(i)},[i]);const c=l=>{a(d=>d+50/r),o(l)},f=l=>{a(d=>d-50/r),o(l)},u=()=>{a(l=>l+50/r),e.toExecises()},g=s.useMemo(()=>e.unkwonWords.map((l,d)=>d===0?s.createElement(h,{...l,key:d,nextWord:()=>c(d+1)}):d===r-1?s.createElement(h,{...l,key:d,previousWord:()=>f(d-1),nextWord:u}):s.createElement(h,{...l,key:d,previousWord:()=>f(d-1),nextWord:()=>c(d+1)})),[e.unkwonWords]);return t("div",{children:g[n]})}function M(e){return s.useContext(N),t("div",{})}const H=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;function _(e){let n=e.replace(H,"");return n=n.replace(/\s+/g," ").trim(),n}function U(e){const n=s.useRef(null),o=_(e.wordName.toLowerCase()),r=c=>{c.preventDefault(),_(n.current.value.toLowerCase())===o?e.correctAnswear():(n.current.value="",e.wrongAnswear())},i=c=>{n.current.value.length<o.length&&(n.current.value+=c)},a=s.useMemo(()=>["ä","ö","ü","ß"].map(c=>t("button",{type:"button",onClick:()=>i(c),children:c})),[]);return m("div",{className:"flex-column--centered word__container",children:[t("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),t("h4",{className:"u-center-text",children:e.translation}),t(k,{sentence:e.example}),m("form",{onSubmit:r,className:"flex-column--centered write_word__form",children:[t("input",{type:"text",className:"flex-element u-center-text",maxLength:o.length,ref:n}),t("div",{className:"flex-element u-center-text umlouts-ctn ",children:a}),m("button",{className:"submitBtn u-center-text",children:["Verfică ",t("i",{className:"fas fa-angle-double-right"})]})]})]})}function V(e,n){switch(n.type){case 0:return console.log("correct"),{...e,wordIndex:e.wordIndex+1};case 1:return console.log("wrong"),{...e,wordIndex:e.wordIndex-1};default:return e}}function j(e){const[n,o]=s.useReducer(V,{score:0,wordIndex:0});s.useEffect(()=>{e.unkwonWords.sort((i,a)=>.5-Math.random())},[]);const r=s.useMemo(()=>e.unkwonWords.map((i,a)=>a%3===1?t(U,{...i,correctAnswear:()=>o({type:0}),wrongAnswear:()=>o({type:1})},a):" "),[e.unkwonWords]);return t("div",{children:r[1]})}const O=s.lazy(()=>R(()=>import("./StartView-4b9904b7.js"),["assets/StartView-4b9904b7.js","assets/index-c3fe12c9.js","assets/index-fb4da303.css"]));function $(e){const[n,o]=s.useState(0),[r,i]=s.useState([]),[a,c]=s.useState(),f=sessionStorage.getItem("lessonType"),u=l=>{e.triggerTransition(),setTimeout(()=>o(l),450)},g=l=>{const d=[];return A.post("http://localhost:5000/lessons/getWords",{moduleId:l}).then(w=>(w.data.forEach(x=>{const{id:I,word:W,translation:S,example:E,moduleId:T}=x,C=new Uint8Array(x.image.data),L=new Blob([C],{type:"application/octet-stream"}),y=URL.createObjectURL(L);d.push({id:I,wordName:W.trim(),translation:S.trim(),example:E,moduleId:T,imageURL:y})}),d))};return s.useEffect(()=>{(f==="new_words"||f==="pronunciation"||f==="test")&&g(e.moduleId).then(l=>{l.sort((d,w)=>.5-Math.random()),i(l)})},[e.moduleId]),s.useEffect(()=>{if(f==="new_words"){c(t(P,{toExecises:()=>u(2),unkwonWords:r,setProgressBar:e.setProgressBar}));return}if(f==="pronunciation"){c(t(M,{toExecises:()=>u(2),unkwonWords:r}));return}},[r]),s.useEffect(()=>{n===2&&c(t(j,{unkwonWords:r}))},[n]),m(v,{children:[n===0&&t(O,{title:e.lessonTitle,startClickHandler:()=>u(1)}),(n===1||n===2)&&a]})}function D(e){const[n,o]=s.useState(!1),r=b(),i=s.useCallback(()=>{sessionStorage.setItem("lessonId",""),sessionStorage.setItem("moduleId",""),sessionStorage.setItem("lessonTitle",""),o(!0),setTimeout(()=>r(-1),410)},[]),a=s.useCallback(()=>{o(!0),setTimeout(()=>e.closeBk(),350)},[]);return t("div",{className:`exit_message__blackdrop ${n&&"exit_message__blackdrop--close"}`,children:m("div",{className:"exit_message__box flex-column--centered",children:[t("div",{className:"btn_exit_ctn",children:t("div",{className:"btn_exit",onClick:a,children:" × "})}),t("h3",{children:" Sigur dorești să închizi lecția ? "}),m("div",{className:"flex-row--centered",children:[t("div",{className:"btn btn--white lesson-btn",onClick:i,children:" Da "}),t("div",{className:"btn btn--blue lesson-btn",onClick:a,children:" Nu "})]})]})})}function J(){const[e,n]=s.useState(!1);return m(v,{children:[e&&t(D,{closeBk:()=>n(!1)}),t("div",{className:"lesson__exit",children:t("button",{className:"lesson__exit__btn",onClick:()=>{n(!0)},children:"×"})})]})}function X(e,n){const o=s.useRef(null);return s.useImperativeHandle(n,()=>({trigger:()=>{o.current.classList.add("lesson-transition--animated")}}),[]),t("div",{className:"lesson-transition",onAnimationEnd:()=>{o.current.classList.remove("lesson-transition--animated")},ref:o})}const p=s.forwardRef(X);function q(){const[e,n]=s.useState({lessonId:-1,moduleId:-1,lessonTitle:""}),[o,r]=s.useState(0),i=b(),a=s.useRef({trigger:()=>{}});s.useEffect(()=>{const u=sessionStorage.getItem("lessonId"),g=sessionStorage.getItem("moduleId"),l=sessionStorage.getItem("lessonTitle");u&&g&&l?n({lessonId:+u,moduleId:+g,lessonTitle:l}):i("/Licenta/PageNotFound")},[]);const c=s.useCallback(u=>{u>=0&&u<=100&&r(u)},[]),f=s.useCallback(()=>{a.current.trigger()},[]);return m("section",{className:"lesson-section",children:[m("div",{className:"lesson-ctn",children:[e.lessonId>=0&&t($,{...e,setProgressBar:c,triggerTransition:f}),t(p,{ref:a})]}),t("div",{className:"lesson__progress-bar",children:t(B,{progressStatus:o})}),t(J,{})]})}export{q as default};
