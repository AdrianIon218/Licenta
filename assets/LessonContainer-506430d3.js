import{j as u,a as s,r as n,V as R,F as x,u as _,_ as $}from"./index-f1a21d99.js";import{a as C}from"./axios-707ed124.js";import{I as N}from"./commonInterfaces-83a6a30d.js";import{N as T,a as B}from"./Notfication-67f8dc53.js";function O({progressStatus:e}){return u("div",{className:"progress-bar__box",children:[s("div",{className:"progress-bar__loading",style:{width:`${e}%`}}),s("div",{className:"progress-bar__grid-half"})]})}function v(e){const[t,c]=n.useState(0),o=n.useContext(R),i=e.sentence.length,m=i<8?i*190:i>20?i*120:i*170;return s("button",{className:"play-btn",onClick:()=>{c(a=>a===0?(o==null||o.readTextWithVoice(e.sentence),setTimeout(()=>{c(0)},m),1):a)},children:s("i",{className:`${t===0?"fa fa-play":"fa fa-pause"}`})})}function S(e){const t=n.useRef(null),[c,o]=n.useState(!1),i=m=>{var f;c||((f=t.current)==null||f.classList.add("word__container--fade-out"),setTimeout(()=>m(),300),o(!0))};return u("div",{className:"flex-column--centered word__container",ref:t,children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h3",{className:"u-center-text",children:e.wordName}),u("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),u("h5",{className:"u-center-text",children:["Ex : ",e.example," "]}),s(v,{sentence:e.wordName}),u("div",{className:"arrow-ctn",children:[e.previousWord!==void 0&&s("i",{className:"fas fa-chevron-circle-left",onClick:()=>i(e.previousWord)}),e.nextWord!==void 0&&s("i",{className:"fas fa-chevron-circle-right arrow-right",onClick:()=>i(e.nextWord)})]})]})}function V(e){const[t,c]=n.useState(0),o=e.unkwonWords.length,[i,m]=n.useState(0);n.useEffect(()=>{e.setProgressBar(i)},[i]);const f=g=>{m(l=>l+50/o),c(g)},a=g=>{m(l=>l-50/o),c(g)},r=()=>{m(g=>g+50/o),e.toExecises()},d=n.useMemo(()=>e.unkwonWords.map((g,l)=>l===0?n.createElement(S,{...g,key:l,nextWord:()=>f(l+1)}):l===o-1?n.createElement(S,{...g,key:l,previousWord:()=>a(l-1),nextWord:r}):n.createElement(S,{...g,key:l,previousWord:()=>a(l-1),nextWord:()=>f(l+1)})),[e.unkwonWords]);return s("div",{children:d[t]})}const j=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;function k(e){let t=e.replace(j,"");return t=t.replace(/\s+/g," ").trim(),t}function L(e){return e.replace(/[ä]/g,"a").replace(/[ü]/g,"u").replace(/[ö]/g,"o")}function J(e){const t=n.useContext(R),[c,o]=n.useState(!1),i=e.textToLookFor.length<10?3:e.textToLookFor.length<20?5:8,m=L(k(e.textToLookFor.toLowerCase()));return s("button",{className:`play-btn btn-record ${c===!0?"btn-recording":""}`,onClick:()=>{if(!c)try{o(!0),t.startRecord(i).then(a=>{a=L(k(a.toLowerCase())),a===m?e.correctAnswear():(e.wrongAnswear(),console.log(a)),o(!1)})}catch{o(!1)}},children:s("i",{className:"fa fa-microphone"})})}function X(e){const[t,c]=n.useState(0),o=n.useCallback(()=>{e.correctAnswear()},[]),i=()=>{c(f=>f+1),e.wrongAnswear()},m=()=>{e.skip()};return u(x,{children:[t>=2&&s("button",{className:"btn-skip",onClick:m,children:"Skip"}),u("div",{className:"flex-column--centered word__container",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s(v,{sentence:e.wordName}),s("h3",{className:"u-center-text",children:e.wordName}),u("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),s(J,{textToLookFor:e.wordName,correctAnswear:o,wrongAnswear:i})]})]})}function D(e){const t=(l,h)=>{switch(h.type){case 0:return e.setProgressBar(l.progressBarStatus+h.ratioProgress),{progressBarStatus:l.progressBarStatus+h.ratioProgress,score:l.score+1,currentWordIndex:l.currentWordIndex+1};case 1:return{...l,score:l.score-1};case 2:return e.setProgressBar(l.progressBarStatus+h.ratioProgress),{...l,progressBarStatus:l.progressBarStatus+h.ratioProgress,score:l.score-1,currentWordIndex:l.currentWordIndex+1};default:return l}},[c,o]=n.useReducer(t,{progressBarStatus:0,score:0,currentWordIndex:0}),i=50/e.unkwonWords.length,[m,f]=n.useState(!1),a=()=>{o({type:0,ratioProgress:i})},r=()=>{o({type:1,ratioProgress:0}),f(!0)},d=()=>{o({type:2,ratioProgress:i})},g=e.unkwonWords.map((l,h)=>n.createElement(X,{...l,key:h,correctAnswear:a,wrongAnswear:r,skip:d}));return u(x,{children:[m&&s(T,{message:"Răspuns greșit !",type:B.ERROR,deleteNotification:()=>f(!1)}),c.currentWordIndex<e.unkwonWords.length&&g[c.currentWordIndex],c.currentWordIndex===e.unkwonWords.length&&e.toExecises(c.score)]})}function z(e){const[t,c]=n.useState(0),o=n.useRef(null),i=k(e.wordName.toLowerCase()),m=r=>{r.preventDefault(),k(o.current.value.toLowerCase())===i?e.correctAnswear():(o.current.value="",c(g=>g+1),e.wrongAnswear())},f=r=>{o.current.value.length<i.length&&(o.current.value+=r,o.current.focus())},a=n.useMemo(()=>["ä","ö","ü","ß"].map((r,d)=>s("button",{type:"button",onClick:()=>f(r),children:r},d)),[]);return u(x,{children:[u("div",{className:"info",children:[s("i",{className:"fa fa-lightbulb-o"}),s("span",{children:u("ul",{children:[s("li",{children:"Nu este nevoie să folosești majuscule ."}),s("li",{children:"Nu folosi semne de punctuație ."})]})})]}),t===2&&s("button",{className:"btn-skip",onClick:e.skipExercise,children:"Skip"}),u("div",{className:"flex-column--centered word__container",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),s(v,{sentence:e.example}),u("form",{onSubmit:m,className:"flex-column--centered write_word__form",children:[s("input",{type:"text",className:"flex-element u-center-text",maxLength:i.length,minLength:2,ref:o,autoFocus:!0}),s("div",{className:"flex-element u-center-text umlouts-ctn ",children:a}),u("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})]})}function G(e){const[t,c]=n.useState(""),o=n.useMemo(()=>{let a=e.wordNames.filter(r=>r!==e.wordName).sort((r,d)=>.5-Math.random()).slice(0,3).concat(e.wordName);return a=a.sort((r,d)=>.5-Math.random()),a},[e.wordNames]),i=a=>{c(a.target.value)},m=n.useMemo(()=>o.map((a,r)=>{const d=`choice-${r}`;return u("div",{className:"choice-ctn",children:[s("label",{htmlFor:d,className:t===a?"choice--checked":"",children:a}),s("input",{type:"checkbox",id:d,name:"choice",value:a,hidden:!0,onChange:i})]},r)}),[o,t]),f=a=>{a.preventDefault(),t===e.wordName?e.correctAnswear():t!==""&&e.wrongAnswear()};return u("div",{className:"flex-column--centered multiple-choice-ex",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),u("form",{className:"flex-column--centered",children:[s("div",{className:"multiple-choices-ctn",children:m}),u("button",{className:"submitBtn u-center-text",onClick:f,children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})}function q(e){const[t,c]=n.useState(""),o=n.useMemo(()=>{let a=e.wordsTranslation.filter(r=>r!==e.translation).sort((r,d)=>.5-Math.random()).slice(0,3).concat(e.translation);return a=a.sort((r,d)=>.5-Math.random()),a},[e.wordsTranslation]),i=a=>{c(a.target.value)},m=n.useMemo(()=>o.map((a,r)=>{const d=`choice-${r}`;return u("div",{className:"choice-ctn",children:[s("label",{htmlFor:d,className:t===a?"choice--checked":"",children:a}),s("input",{type:"checkbox",id:d,name:"choice",value:a,hidden:!0,onChange:i})]},r)}),[o,t]),f=a=>{a.preventDefault(),t===e.translation?e.correctAnswear():t!==""&&e.wrongAnswear()};return u("div",{className:"flex-column--centered multiple-choice-ex",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.wordName}),s(v,{sentence:e.wordName}),u("form",{className:"flex-column--centered",children:[s("div",{className:"multiple-choices-ctn",children:m}),u("button",{className:"submitBtn u-center-text",onClick:f,children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})}function K(e){const[t,c]=n.useReducer(f,{progressBar:50,score:0,wordIndex:0}),[o,i]=n.useState(!1),m=e.unkwonWords.length;function f(r,d){const g=50/e.unkwonWords.length;switch(d.type){case 0:return e.setProgressBar(r.progressBar+g),{progressBar:r.progressBar+g,score:r.score+1,wordIndex:r.wordIndex+1};case 1:return{...r,score:r.score-1};case 2:return e.setProgressBar(r.progressBar+g),{progressBar:r.progressBar+g,score:r.score-1,wordIndex:r.wordIndex+1};default:return r}}n.useEffect(()=>{e.unkwonWords.sort((r,d)=>.5-Math.random())},[]);const a=n.useMemo(()=>{const r=e.unkwonWords.map(l=>l.wordName),d=e.unkwonWords.map(l=>l.translation),g={correctAnswear:()=>{c({type:0}),i(!1)},wrongAnswear:()=>{c({type:1}),i(!0)}};return e.unkwonWords.map((l,h)=>{const w=h%3;return w===1?s(z,{...l,...g,skipExercise:()=>{c({type:2}),i(!1)}},h):w===0?s(G,{...l,...g,wordNames:r},h):s(q,{...l,...g,wordsTranslation:d},h)})},[e.unkwonWords]);return n.useEffect(()=>{if(t.wordIndex===e.unkwonWords.length){const r=t.score<=m/3?N.STAR_1:t.score<=m/2?N.STAR_2:N.STAR_3;e.onFinish(r)}},[t.wordIndex]),u("div",{className:"new_words_ex",children:[o&&s(T,{message:"Răspuns greșit !",type:B.ERROR,deleteNotification:()=>i(!1)}),t.wordIndex<e.unkwonWords.length&&a[t.wordIndex]]})}function Q(e){const t=_();return n.useEffect(()=>{const c=localStorage.getItem("userAccount"),o=sessionStorage.getItem("lessonId");sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),sessionStorage.removeItem("lessonType"),c?C.post("http://localhost:5000/lessons/addProgress",{email:c,lessonId:o,status:e.statusLesson}).then(i=>{sessionStorage.removeItem("lessonId")}):sessionStorage.removeItem("lessonId")},[]),u("div",{className:"flex-column--centered",children:[s("h3",{className:"heading-secondary u-center-text",children:"Lecție terminată"}),u("div",{className:"result-stars",children:[s("i",{className:`fa fa-star ${e.statusLesson!==N.NO_PROGRESS&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson===N.STAR_3&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson>N.STAR_1&&"course-status--checked"}`})]}),s("button",{className:"btn-gradient-cyan",onClick:()=>t(-1),children:" Înapoi la lecții"})]})}const Y=n.lazy(()=>$(()=>import("./StartView-6af6757d.js"),["assets/StartView-6af6757d.js","assets/index-f1a21d99.js","assets/index-dd817df2.css"]));function Z(e){const[t,c]=n.useState(0),[o,i]=n.useState([]),[m,f]=n.useState(),[a,r]=n.useState(N.NO_PROGRESS),d=sessionStorage.getItem("lessonType"),g=w=>{e.triggerTransition(),setTimeout(()=>c(w),450)},l=w=>{const b=[];return C.post("http://localhost:5000/lessons/getWords",{moduleId:w}).then(I=>(I.data.forEach(W=>{const{id:A,word:E,translation:y,example:P,moduleId:M}=W,H=new Uint8Array(W.image.data),F=new Blob([H],{type:"application/octet-stream"}),U=URL.createObjectURL(F);b.push({id:A,wordName:E.trim(),translation:y.trim(),example:P,moduleId:M,imageURL:U})}),b))};n.useEffect(()=>{(d==="new_words"||d==="pronunciation"||d==="test")&&l(e.moduleId).then(w=>{w.sort((b,I)=>.5-Math.random()),i(w)})},[e.moduleId]),n.useEffect(()=>{if(d==="new_words"){f(s(V,{toExecises:()=>g(2),unkwonWords:o,setProgressBar:e.setProgressBar}));return}if(d==="pronunciation"){f(s(D,{toExecises:w=>e.triggerTransition(),unkwonWords:o,setProgressBar:e.setProgressBar}));return}},[o]);const h=w=>{r(w),g(3)};return n.useEffect(()=>{t===2&&d!=="pronunciation"&&f(s(K,{unkwonWords:o,setProgressBar:e.setProgressBar,onFinish:h})),t===3&&f(s(Q,{statusLesson:a}))},[t,a]),u(x,{children:[t===0&&s(Y,{title:e.lessonTitle,startClickHandler:()=>g(1)}),(t===1||t===2||t===3)&&m]})}function p(e){const[t,c]=n.useState(!1),o=_(),i=n.useCallback(()=>{sessionStorage.removeItem("lessonType"),sessionStorage.removeItem("lessonId"),sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),c(!0),setTimeout(()=>o(-1),410)},[]),m=n.useCallback(()=>{c(!0),setTimeout(()=>e.closeBk(),350)},[]);return s("div",{className:`exit_message__blackdrop ${t&&"exit_message__blackdrop--close"}`,children:u("div",{className:"exit_message__box flex-column--centered",children:[s("div",{className:"btn_exit_ctn",children:s("div",{className:"btn_exit",onClick:m,children:" × "})}),s("h3",{children:" Sigur dorești să închizi lecția ? "}),u("div",{className:"flex-row--centered",children:[s("div",{className:"btn btn--white lesson-btn",onClick:i,children:" Da "}),s("div",{className:"btn btn--blue lesson-btn",onClick:m,children:" Nu "})]})]})})}function ee(){const[e,t]=n.useState(!1);return u(x,{children:[e&&s(p,{closeBk:()=>t(!1)}),s("div",{className:"lesson__exit",children:s("button",{className:"lesson__exit__btn",onClick:()=>{t(!0)},children:"×"})})]})}function se(e,t){const c=n.useRef(null);return n.useImperativeHandle(t,()=>({trigger:()=>{c.current.classList.add("lesson-transition--animated")}}),[]),s("div",{className:"lesson-transition",onAnimationEnd:()=>{c.current.classList.remove("lesson-transition--animated")},ref:c})}const te=n.forwardRef(se);function ce(){const[e,t]=n.useState({lessonId:-1,moduleId:-1,lessonTitle:""}),[c,o]=n.useState(0),i=_(),m=n.useRef({trigger:()=>{}});n.useEffect(()=>{const r=sessionStorage.getItem("lessonId"),d=sessionStorage.getItem("moduleId"),g=sessionStorage.getItem("lessonTitle");r&&d&&g?t({lessonId:+r,moduleId:+d,lessonTitle:g}):i("/Licenta/PageNotFound")},[]);const f=n.useCallback(r=>{r>=0&&r<=100&&o(r)},[]),a=n.useCallback(()=>{m.current.trigger()},[]);return s("div",{className:"lesson-section-ctn",children:u("section",{className:"lesson-section",children:[u("div",{className:"lesson-ctn",children:[e.lessonId>=0&&s(Z,{...e,setProgressBar:f,triggerTransition:a}),s(te,{ref:m})]}),s("div",{className:"lesson__progress-bar",children:s(O,{progressStatus:c})}),s(ee,{})]})})}export{ce as default};
