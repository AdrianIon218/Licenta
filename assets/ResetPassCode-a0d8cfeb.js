import{r,j as f,u as T,e as _,F as S,a as s}from"./index-927f409d.js";import{a as u,N as E}from"./Notfication-431797d0.js";function v(c){const[a,h]=r.useState({min:10,sec:0}),m=(n,i,d)=>{const l=n*60*60*1e3,o=i*60*1e3,e=d*1e3;return l+o+e};return r.useEffect(()=>{const n=c.time.split(":"),i=+n[0];let d=m(i,+n[1],+n[2]);const l=setInterval(()=>{const o=new Date;let e=o.getHours();e=e>12?e-12:e,e===11&&i===0&&(d=m(12,+n[1],+n[2]));let p=m(e,o.getMinutes(),o.getSeconds()),t=d-p;t<0?(c.codeExpire(),clearInterval(l)):h({min:Math.floor(t/1e3/60),sec:t/1e3%60})},1e3);return()=>{clearInterval(l)}},[c.time]),f("span",{style:{color:"red"},children:[a.min," min ",a.sec," sec"]})}function C(){const c=T(),[a,h]=r.useState(""),[m,n]=r.useState(""),[i,d]=r.useState(!1),[l,o]=r.useState({isShown:!1,messsage:"",type:u.NO_TYPE}),e=r.useRef(null);r.useEffect(()=>{const t=sessionStorage.getItem("emailToReset");if(!t){c("/Licenta/password_reset");return}h(t),sessionStorage.getItem("allowToResetPass")&&c("/Licenta/password_reset/new_password")},[]),r.useEffect(()=>{a&&_.post("http://localhost:5000/login/get_code_expire_time",{email:a}).then(t=>{const{status:g}=t.data;if(g){const{expire_at:w}=t.data;n(w)}else d(!0)})},[a]);const p=t=>{if(t.preventDefault(),i)c("/Licenta/login");else{const g=e.current.value;_.post("http://localhost:5000/login/verify_code_reset",{email:a,enteredCode:g}).then(w=>{const{status:x,isCorrect:N}=w.data;N?(sessionStorage.setItem("allowToResetPass","true"),c("/Licenta/password_reset/new_password")):o(x?{isShown:!0,messsage:"Codul este incorect !",type:u.WARNING}:{isShown:!0,messsage:"Eroare, încercați mai târziu !",type:u.ERROR})}).catch(()=>{o({isShown:!0,messsage:"Eroare, încercați mai târziu !",type:u.ERROR})})}};return f(S,{children:[l.isShown&&s(E,{message:l.messsage,type:l.type,deleteNotification:()=>{o({isShown:!1,messsage:"",type:u.NO_TYPE})}}),s("section",{className:"section-gradient section-header u_padding_down--big",children:s("div",{className:"flex-row--centered",children:s("div",{className:"box-mountain-bg",children:s("div",{className:"box-mountain-bg__form",children:f("form",{className:"forn",children:[f("div",{className:"u-center-text u-margin-bottom-medium",children:[s("h2",{className:"heading-secondary",style:{textTransform:"none"},children:i?`Codul trimis la ${a} a expirat!`:`Introduceți codul trimis la adresa ${a}`}),f("p",{style:{fontSize:"1rem",fontWeight:800},hidden:i,children:["Codul expiră în  ",s(v,{time:m,codeExpire:()=>d(!0)})]})]}),s("div",{className:"form__group u-margin-bottom-intermediate",hidden:i,children:s("input",{type:"password",className:"form__input u-center-text",placeholder:"Cod de resetare",id:"password",name:"password",minLength:6,maxLength:6,required:!0,ref:e})}),s("div",{className:"form__group",children:s("button",{className:"btn btn--white",onClick:p,children:i?"Înapoi la autentificare":"Verifică codul"})})]})})})})})]})}export{C as default};
