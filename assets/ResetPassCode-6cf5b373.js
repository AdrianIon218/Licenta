import{r as c,j as g,u as N,e as _,F as S,a as s}from"./index-5f6bd802.js";import{a as h,N as E}from"./Notfication-a0c7a9fc.js";function v(l){const[o,x]=c.useState({min:10,sec:0}),u=(d,e,a)=>{const n=d*60*60*1e3,r=e*60*1e3,m=a*1e3;return n+r+m};return c.useEffect(()=>{const d=l.time.split(":");let e=+d[0];e=e===12?0:e;const a=+d[1],n=+d[2],r=e===0&&a<10;let m=u(e,a,n);const w=setInterval(()=>{const t=new Date;let i=t.getHours();i=i>=12?i-12:i,i===0&&r?m=u(0,a,n):r&&(m=u(12,a,n));let f=u(i,t.getMinutes(),t.getSeconds()),p=m-f;p<0?(l.codeExpire(),clearInterval(w)):x({min:Math.floor(p/1e3/60),sec:p/1e3%60})},1e3);return()=>{clearInterval(w)}},[l.time]),g("span",{style:{color:"red"},children:[o.min," min ",o.sec," sec"]})}function C(){const l=N(),[o,x]=c.useState(""),[u,d]=c.useState(""),[e,a]=c.useState(!1),[n,r]=c.useState({isShown:!1,messsage:"",type:h.NO_TYPE}),m=c.useRef(null);c.useEffect(()=>{const t=sessionStorage.getItem("emailToReset");if(!t){l("/Licenta/password_reset");return}x(t),sessionStorage.getItem("allowToResetPass")&&l("/Licenta/password_reset/new_password")},[]),c.useEffect(()=>{o&&_.post("http://localhost:5000/login/get_code_expire_time",{email:o}).then(t=>{const{status:i}=t.data;if(i){const{expire_at:f}=t.data;d(f)}else a(!0)})},[o]);const w=t=>{if(t.preventDefault(),e)l("/Licenta/login");else{const i=m.current.value;_.post("http://localhost:5000/login/verify_code_reset",{email:o,enteredCode:i}).then(f=>{const{status:p,isCorrect:T}=f.data;T?(sessionStorage.setItem("allowToResetPass","true"),l("/Licenta/password_reset/new_password")):r(p?{isShown:!0,messsage:"Codul este incorect !",type:h.WARNING}:{isShown:!0,messsage:"Eroare, încercați mai târziu !",type:h.ERROR})}).catch(()=>{r({isShown:!0,messsage:"Eroare, încercați mai târziu !",type:h.ERROR})})}};return g(S,{children:[n.isShown&&s(E,{message:n.messsage,type:n.type,deleteNotification:()=>{r({isShown:!1,messsage:"",type:h.NO_TYPE})}}),s("section",{className:"section-gradient section-header u_padding_down--big",children:s("div",{className:"flex-row--centered",children:s("div",{className:"box-mountain-bg",children:s("div",{className:"box-mountain-bg__form",children:g("form",{className:"forn",children:[g("div",{className:"u-center-text u-margin-bottom-medium",children:[s("h2",{className:"heading-secondary",style:{textTransform:"none"},children:e?`Codul trimis la ${o} a expirat!`:`Introduceți codul trimis la adresa ${o}`}),g("p",{style:{fontSize:"1rem",fontWeight:800},hidden:e,children:["Codul expiră în  ",s(v,{time:u,codeExpire:()=>a(!0)})]})]}),s("div",{className:"form__group u-margin-bottom-intermediate",hidden:e,children:s("input",{type:"password",className:"form__input u-center-text",placeholder:"Cod de resetare",id:"password",name:"password",minLength:6,maxLength:6,required:!0,ref:m})}),s("div",{className:"form__group",children:s("button",{className:"btn btn--white",onClick:w,children:e?"Înapoi la autentificare":"Verifică codul"})})]})})})})})]})}export{C as default};
