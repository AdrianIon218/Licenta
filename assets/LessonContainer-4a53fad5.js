import{j as m,a as s,r as n,V as W,F as x,u as _,_ as $}from"./index-b600b755.js";import{a as E}from"./axios-707ed124.js";import{I as w}from"./commonInterfaces-83a6a30d.js";import{N as O,a as U}from"./Notfication-802e3eaa.js";function V({progressStatus:e}){return m("div",{className:"progress-bar__box",children:[s("div",{className:"progress-bar__loading",style:{width:`${e}%`}}),s("div",{className:"progress-bar__grid-half"})]})}function L(e){const[t,r]=n.useState(0),a=n.useContext(W),c=e.sentence.length,f=c<8?c*190:c>20?c*120:c*170;return s("button",{className:"play-btn",onClick:()=>{r(i=>i===0?(a==null||a.readTextWithVoice(e.sentence),setTimeout(()=>{r(0)},f),1):i)},children:s("i",{className:`${t===0?"fa fa-play":"fa fa-pause"}`})})}function v(e){const t=n.useRef(null),[r,a]=n.useState(!1),c=f=>{var u;r||((u=t.current)==null||u.classList.add("word__container--fade-out"),setTimeout(()=>f(),300),a(!0))};return m("div",{className:"flex-column--centered word__container",ref:t,children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h3",{className:"u-center-text",children:e.wordName}),m("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),m("h5",{className:"u-center-text",children:["Ex : ",e.example," "]}),s(L,{sentence:e.wordName}),m("div",{className:"arrow-ctn",children:[e.previousWord!==void 0&&s("i",{className:"fas fa-chevron-circle-left",onClick:()=>c(e.previousWord)}),e.nextWord!==void 0&&s("i",{className:"fas fa-chevron-circle-right arrow-right",onClick:()=>c(e.nextWord)})]})]})}function j(e){const[t,r]=n.useState(0),a=e.unkwonWords.length,[c,f]=n.useState(0);n.useEffect(()=>{e.setProgressBar(c)},[c]);const u=l=>{f(g=>g+50/a),r(l)},i=l=>{f(g=>g-50/a),r(l)},o=()=>{f(l=>l+50/a),e.toExecises()},d=n.useMemo(()=>e.unkwonWords.map((l,g)=>g===0?n.createElement(v,{...l,key:g,nextWord:()=>u(g+1)}):g===a-1?n.createElement(v,{...l,key:g,previousWord:()=>i(g-1),nextWord:o}):n.createElement(v,{...l,key:g,previousWord:()=>i(g-1),nextWord:()=>u(g+1)})),[e.unkwonWords]);return s("div",{children:d[t]})}function F(e){return n.useContext(W),s("div",{})}const D=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;function I(e){let t=e.replace(D,"");return t=t.replace(/\s+/g," ").trim(),t}function k(e){const t=n.useRef(null),r=I(e.wordName.toLowerCase()),a=u=>{u.preventDefault(),I(t.current.value.toLowerCase())===r?e.correctAnswear():(t.current.value="",e.wrongAnswear())},c=u=>{t.current.value.length<r.length&&(t.current.value+=u,t.current.focus())},f=n.useMemo(()=>["ä","ö","ü","ß"].map((u,i)=>s("button",{type:"button",onClick:()=>c(u),children:u},i)),[]);return m(x,{children:[m("div",{className:"info",children:[s("i",{className:"fa fa-lightbulb-o"}),s("span",{children:m("ul",{children:[s("li",{children:"Nu este nevoie să folosești majuscule ."}),s("li",{children:"Nu folosi semne de punctuație ."})]})})]}),m("div",{className:"flex-column--centered word__container",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),s(L,{sentence:e.example}),m("form",{onSubmit:a,className:"flex-column--centered write_word__form",children:[s("input",{type:"text",className:"flex-element u-center-text",maxLength:r.length,ref:t,autoFocus:!0}),s("div",{className:"flex-element u-center-text umlouts-ctn ",children:f}),m("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})]})}function J(e){const[t,r]=n.useState(""),a=n.useMemo(()=>{let i=e.wordNames.filter(o=>o!==e.wordName).sort((o,d)=>.5-Math.random()).slice(0,3).concat(e.wordName);return i=i.sort((o,d)=>.5-Math.random()),i},[e.wordNames]),c=i=>{r(i.target.value)},f=n.useMemo(()=>a.map((i,o)=>{const d=`choice-${o}`;return m("div",{className:"choice-ctn",children:[s("label",{htmlFor:d,className:t===i?"choice--checked":"",children:i}),s("input",{type:"checkbox",id:`choice-${o}`,name:"choice",value:i,hidden:!0,onChange:c})]},o)}),[a,t]),u=i=>{i.preventDefault(),t===e.wordName?e.correctAnswear():e.wrongAnswear()};return m("div",{className:"flex-column--centered multiple-choice-ex",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),m("form",{onSubmit:u,className:"flex-column--centered",children:[s("div",{className:"multiple-choices-ctn",children:f}),m("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})}function X(e){const[t,r]=n.useReducer(u,{progressBar:50,score:0,wordIndex:0}),[a,c]=n.useState(!1),f=e.unkwonWords.length;function u(o,d){const l=50/e.unkwonWords.length;switch(d.type){case 0:return e.setProgressBar(o.progressBar+l),{progressBar:o.progressBar+l,score:o.score+1,wordIndex:o.wordIndex+1};case 1:return{...o,score:o.score-1};default:return o}}n.useEffect(()=>{e.unkwonWords.sort((o,d)=>.5-Math.random())},[]);const i=n.useMemo(()=>{const o=e.unkwonWords.map(d=>d.wordName);return e.unkwonWords.map((d,l)=>{const g=l%3;return g===1?s(k,{...d,correctAnswear:()=>r({type:0}),wrongAnswear:()=>{r({type:1}),c(!0)}},l):g===0?s(J,{...d,correctAnswear:()=>r({type:0}),wrongAnswear:()=>{r({type:1}),c(!0)},wordNames:o},l):s(k,{...d,correctAnswear:()=>r({type:0}),wrongAnswear:()=>{r({type:1}),c(!0)}},l)})},[e.unkwonWords]);return n.useEffect(()=>{if(t.wordIndex===e.unkwonWords.length){const o=t.score<=f/3?w.STAR_1:t.score<=f/2?w.STAR_2:w.STAR_3;console.log(o),e.onFinish(o)}},[t.wordIndex]),m("div",{className:"new_words_ex",children:[a&&s(O,{message:"Răspuns greșit !",type:U.ERROR,deleteNotification:()=>c(!1)}),t.wordIndex<e.unkwonWords.length&&i[t.wordIndex]]})}function z(e){const t=_();return n.useEffect(()=>{const r=localStorage.getItem("userAccount"),a=sessionStorage.getItem("lessonId");sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),sessionStorage.removeItem("lessonType"),r?E.post("http://localhost:5000/lessons/addProgress",{email:r,lessonId:a,status:e.statusLesson}).then(c=>{console.log(c),sessionStorage.removeItem("lessonId")}):sessionStorage.removeItem("lessonId")},[]),m("div",{className:"flex-column--centered",children:[s("h3",{className:"heading-secondary u-center-text",children:"Lecție terminată"}),m("div",{className:"result-stars",children:[s("i",{className:`fa fa-star ${e.statusLesson!==w.NO_PROGRESS&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson===w.STAR_3&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson>w.STAR_1&&"course-status--checked"}`})]}),s("button",{className:"btn-gradient-cyan",onClick:()=>t(-1),children:" Înapoi la lecții"})]})}const G=n.lazy(()=>$(()=>import("./StartView-94a70744.js"),["assets/StartView-94a70744.js","assets/index-b600b755.js","assets/index-a2363f62.css"]));function q(e){const[t,r]=n.useState(0),[a,c]=n.useState([]),[f,u]=n.useState(),[i,o]=n.useState(w.NO_PROGRESS),d=sessionStorage.getItem("lessonType"),l=h=>{e.triggerTransition(),setTimeout(()=>r(h),450)},g=h=>{const N=[];return E.post("http://localhost:5000/lessons/getWords",{moduleId:h}).then(b=>(b.data.forEach(S=>{const{id:T,word:y,translation:C,example:A,moduleId:B}=S,P=new Uint8Array(S.image.data),M=new Blob([P],{type:"application/octet-stream"}),H=URL.createObjectURL(M);N.push({id:T,wordName:y.trim(),translation:C.trim(),example:A,moduleId:B,imageURL:H})}),N))};n.useEffect(()=>{(d==="new_words"||d==="pronunciation"||d==="test")&&g(e.moduleId).then(h=>{h.sort((N,b)=>.5-Math.random()),c(h)})},[e.moduleId]),n.useEffect(()=>{if(d==="new_words"){u(s(j,{toExecises:()=>l(2),unkwonWords:a,setProgressBar:e.setProgressBar}));return}if(d==="pronunciation"){u(s(F,{toExecises:()=>l(2),unkwonWords:a}));return}},[a]);const R=h=>{o(h),l(3)};return n.useEffect(()=>{t===2&&u(s(X,{unkwonWords:a,setProgressBar:e.setProgressBar,onFinish:R})),t===3&&u(s(z,{statusLesson:i}))},[t,i]),m(x,{children:[t===0&&s(G,{title:e.lessonTitle,startClickHandler:()=>l(1)}),(t===1||t===2||t===3)&&f]})}function K(e){const[t,r]=n.useState(!1),a=_(),c=n.useCallback(()=>{sessionStorage.removeItem("lessonType"),sessionStorage.removeItem("lessonId"),sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),r(!0),setTimeout(()=>a(-1),410)},[]),f=n.useCallback(()=>{r(!0),setTimeout(()=>e.closeBk(),350)},[]);return s("div",{className:`exit_message__blackdrop ${t&&"exit_message__blackdrop--close"}`,children:m("div",{className:"exit_message__box flex-column--centered",children:[s("div",{className:"btn_exit_ctn",children:s("div",{className:"btn_exit",onClick:f,children:" × "})}),s("h3",{children:" Sigur dorești să închizi lecția ? "}),m("div",{className:"flex-row--centered",children:[s("div",{className:"btn btn--white lesson-btn",onClick:c,children:" Da "}),s("div",{className:"btn btn--blue lesson-btn",onClick:f,children:" Nu "})]})]})})}function Q(){const[e,t]=n.useState(!1);return m(x,{children:[e&&s(K,{closeBk:()=>t(!1)}),s("div",{className:"lesson__exit",children:s("button",{className:"lesson__exit__btn",onClick:()=>{t(!0)},children:"×"})})]})}function Y(e,t){const r=n.useRef(null);return n.useImperativeHandle(t,()=>({trigger:()=>{r.current.classList.add("lesson-transition--animated")}}),[]),s("div",{className:"lesson-transition",onAnimationEnd:()=>{r.current.classList.remove("lesson-transition--animated")},ref:r})}const Z=n.forwardRef(Y);function ne(){const[e,t]=n.useState({lessonId:-1,moduleId:-1,lessonTitle:""}),[r,a]=n.useState(0),c=_(),f=n.useRef({trigger:()=>{}});n.useEffect(()=>{const o=sessionStorage.getItem("lessonId"),d=sessionStorage.getItem("moduleId"),l=sessionStorage.getItem("lessonTitle");o&&d&&l?t({lessonId:+o,moduleId:+d,lessonTitle:l}):c("/Licenta/PageNotFound")},[]);const u=n.useCallback(o=>{o>=0&&o<=100&&a(o)},[]),i=n.useCallback(()=>{f.current.trigger()},[]);return m("section",{className:"lesson-section",children:[m("div",{className:"lesson-ctn",children:[e.lessonId>=0&&s(q,{...e,setProgressBar:u,triggerTransition:i}),s(Z,{ref:f})]}),s("div",{className:"lesson__progress-bar",children:s(V,{progressStatus:r})}),s(Q,{})]})}export{ne as default};
