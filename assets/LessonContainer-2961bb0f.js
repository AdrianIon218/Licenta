import{j as i,a as s,r as n,V as T,F as b,u as _,_ as H}from"./index-3b8a878d.js";import{a as L}from"./axios-707ed124.js";import{I as N}from"./commonInterfaces-83a6a30d.js";import{N as U,a as $}from"./Notfication-7f47db7f.js";function O({progressStatus:e}){return i("div",{className:"progress-bar__box",children:[s("div",{className:"progress-bar__loading",style:{width:`${e}%`}}),s("div",{className:"progress-bar__grid-half"})]})}function S(e){const[t,a]=n.useState(0),c=n.useContext(T),l=e.sentence.length,m=l<8?l*190:l>20?l*120:l*170;return s("button",{className:"play-btn",onClick:()=>{a(r=>r===0?(c==null||c.readTextWithVoice(e.sentence),setTimeout(()=>{a(0)},m),1):r)},children:s("i",{className:`${t===0?"fa fa-play":"fa fa-pause"}`})})}function x(e){const t=n.useRef(null),[a,c]=n.useState(!1),l=m=>{var d;a||((d=t.current)==null||d.classList.add("word__container--fade-out"),setTimeout(()=>m(),300),c(!0))};return i("div",{className:"flex-column--centered word__container",ref:t,children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h3",{className:"u-center-text",children:e.wordName}),i("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),i("h5",{className:"u-center-text",children:["Ex : ",e.example," "]}),s(S,{sentence:e.wordName}),i("div",{className:"arrow-ctn",children:[e.previousWord!==void 0&&s("i",{className:"fas fa-chevron-circle-left",onClick:()=>l(e.previousWord)}),e.nextWord!==void 0&&s("i",{className:"fas fa-chevron-circle-right arrow-right",onClick:()=>l(e.nextWord)})]})]})}function V(e){const[t,a]=n.useState(0),c=e.unkwonWords.length,[l,m]=n.useState(0);n.useEffect(()=>{e.setProgressBar(l)},[l]);const d=f=>{m(h=>h+50/c),a(f)},r=f=>{m(h=>h-50/c),a(f)},o=()=>{m(f=>f+50/c),e.toExecises()},u=n.useMemo(()=>e.unkwonWords.map((f,h)=>h===0?n.createElement(x,{...f,key:h,nextWord:()=>d(h+1)}):h===c-1?n.createElement(x,{...f,key:h,previousWord:()=>r(h-1),nextWord:o}):n.createElement(x,{...f,key:h,previousWord:()=>r(h-1),nextWord:()=>d(h+1)})),[e.unkwonWords]);return s("div",{children:u[t]})}function F(e){return n.useContext(T),s("div",{})}const j=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;function W(e){let t=e.replace(j,"");return t=t.replace(/\s+/g," ").trim(),t}function D(e){const t=n.useRef(null),a=W(e.wordName.toLowerCase()),c=d=>{d.preventDefault(),W(t.current.value.toLowerCase())===a?e.correctAnswear():(t.current.value="",e.wrongAnswear())},l=d=>{t.current.value.length<a.length&&(t.current.value+=d,t.current.focus())},m=n.useMemo(()=>["ä","ö","ü","ß"].map((d,r)=>s("button",{type:"button",onClick:()=>l(d),children:d},r)),[]);return i(b,{children:[i("div",{className:"info",children:[s("i",{className:"fa fa-lightbulb-o"}),s("span",{children:i("ul",{children:[s("li",{children:"Nu este nevoie să folosești majuscule ."}),s("li",{children:"Nu folosi semne de punctuație ."})]})})]}),i("div",{className:"flex-column--centered word__container",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),s(S,{sentence:e.example}),i("form",{onSubmit:c,className:"flex-column--centered write_word__form",children:[s("input",{type:"text",className:"flex-element u-center-text",maxLength:a.length,ref:t,autoFocus:!0}),s("div",{className:"flex-element u-center-text umlouts-ctn ",children:m}),i("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})]})}function J(e){const[t,a]=n.useState(""),c=n.useMemo(()=>{let r=e.wordNames.filter(o=>o!==e.wordName).sort((o,u)=>.5-Math.random()).slice(0,3).concat(e.wordName);return r=r.sort((o,u)=>.5-Math.random()),r},[e.wordNames]),l=r=>{a(r.target.value)},m=n.useMemo(()=>c.map((r,o)=>{const u=`choice-${o}`;return i("div",{className:"choice-ctn",children:[s("label",{htmlFor:u,className:t===r?"choice--checked":"",children:r}),s("input",{type:"checkbox",id:u,name:"choice",value:r,hidden:!0,onChange:l})]},o)}),[c,t]),d=r=>{r.preventDefault(),t===e.wordName?e.correctAnswear():e.wrongAnswear()};return i("div",{className:"flex-column--centered multiple-choice-ex",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),i("form",{onSubmit:d,className:"flex-column--centered",children:[s("div",{className:"multiple-choices-ctn",children:m}),i("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})}function X(e){const[t,a]=n.useState(""),c=n.useMemo(()=>{let r=e.wordsTranslation.filter(o=>o!==e.translation).sort((o,u)=>.5-Math.random()).slice(0,3).concat(e.translation);return r=r.sort((o,u)=>.5-Math.random()),r},[e.wordsTranslation]),l=r=>{a(r.target.value)},m=n.useMemo(()=>c.map((r,o)=>{const u=`choice-${o}`;return i("div",{className:"choice-ctn",children:[s("label",{htmlFor:u,className:t===r?"choice--checked":"",children:r}),s("input",{type:"checkbox",id:u,name:"choice",value:r,hidden:!0,onChange:l})]},o)}),[c,t]),d=r=>{r.preventDefault(),t===e.translation?e.correctAnswear():e.wrongAnswear()};return i("div",{className:"flex-column--centered multiple-choice-ex",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.wordName}),s(S,{sentence:e.wordName}),i("form",{onSubmit:d,className:"flex-column--centered",children:[s("div",{className:"multiple-choices-ctn",children:m}),i("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})}function z(e){const[t,a]=n.useReducer(d,{progressBar:50,score:0,wordIndex:0}),[c,l]=n.useState(!1),m=e.unkwonWords.length;function d(o,u){const f=50/e.unkwonWords.length;switch(u.type){case 0:return e.setProgressBar(o.progressBar+f),{progressBar:o.progressBar+f,score:o.score+1,wordIndex:o.wordIndex+1};case 1:return{...o,score:o.score-1};default:return o}}n.useEffect(()=>{e.unkwonWords.sort((o,u)=>.5-Math.random())},[]);const r=n.useMemo(()=>{const o=e.unkwonWords.map(h=>h.wordName),u=e.unkwonWords.map(h=>h.translation),f={correctAnswear:()=>a({type:0}),wrongAnswear:()=>{a({type:1}),l(!0)}};return e.unkwonWords.map((h,w)=>{const g=w%3;return g===1?s(D,{...h,...f},w):g===0?s(J,{...h,...f,wordNames:o},w):s(X,{...h,...f,wordsTranslation:u},w)})},[e.unkwonWords]);return n.useEffect(()=>{if(t.wordIndex===e.unkwonWords.length){const o=t.score<=m/3?N.STAR_1:t.score<=m/2?N.STAR_2:N.STAR_3;e.onFinish(o)}},[t.wordIndex]),i("div",{className:"new_words_ex",children:[c&&s(U,{message:"Răspuns greșit !",type:$.ERROR,deleteNotification:()=>l(!1)}),t.wordIndex<e.unkwonWords.length&&r[t.wordIndex]]})}function G(e){const t=_();return n.useEffect(()=>{const a=localStorage.getItem("userAccount"),c=sessionStorage.getItem("lessonId");sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),sessionStorage.removeItem("lessonType"),a?L.post("http://localhost:5000/lessons/addProgress",{email:a,lessonId:c,status:e.statusLesson}).then(l=>{sessionStorage.removeItem("lessonId")}):sessionStorage.removeItem("lessonId")},[]),i("div",{className:"flex-column--centered",children:[s("h3",{className:"heading-secondary u-center-text",children:"Lecție terminată"}),i("div",{className:"result-stars",children:[s("i",{className:`fa fa-star ${e.statusLesson!==N.NO_PROGRESS&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson===N.STAR_3&&"course-status--checked"}`}),s("i",{className:`fa fa-star ${e.statusLesson>N.STAR_1&&"course-status--checked"}`})]}),s("button",{className:"btn-gradient-cyan",onClick:()=>t(-1),children:" Înapoi la lecții"})]})}const q=n.lazy(()=>H(()=>import("./StartView-47a62ce4.js"),["assets/StartView-47a62ce4.js","assets/index-3b8a878d.js","assets/index-a2363f62.css"]));function K(e){const[t,a]=n.useState(0),[c,l]=n.useState([]),[m,d]=n.useState(),[r,o]=n.useState(N.NO_PROGRESS),u=sessionStorage.getItem("lessonType"),f=g=>{e.triggerTransition(),setTimeout(()=>a(g),450)},h=g=>{const v=[];return L.post("http://localhost:5000/lessons/getWords",{moduleId:g}).then(I=>(I.data.forEach(k=>{const{id:E,word:C,translation:R,example:y,moduleId:A}=k,M=new Uint8Array(k.image.data),B=new Blob([M],{type:"application/octet-stream"}),P=URL.createObjectURL(B);v.push({id:E,wordName:C.trim(),translation:R.trim(),example:y,moduleId:A,imageURL:P})}),v))};n.useEffect(()=>{(u==="new_words"||u==="pronunciation"||u==="test")&&h(e.moduleId).then(g=>{g.sort((v,I)=>.5-Math.random()),l(g)})},[e.moduleId]),n.useEffect(()=>{if(u==="new_words"){d(s(V,{toExecises:()=>f(2),unkwonWords:c,setProgressBar:e.setProgressBar}));return}if(u==="pronunciation"){d(s(F,{toExecises:()=>f(2),unkwonWords:c}));return}},[c]);const w=g=>{o(g),f(3)};return n.useEffect(()=>{t===2&&d(s(z,{unkwonWords:c,setProgressBar:e.setProgressBar,onFinish:w})),t===3&&d(s(G,{statusLesson:r}))},[t,r]),i(b,{children:[t===0&&s(q,{title:e.lessonTitle,startClickHandler:()=>f(1)}),(t===1||t===2||t===3)&&m]})}function Q(e){const[t,a]=n.useState(!1),c=_(),l=n.useCallback(()=>{sessionStorage.removeItem("lessonType"),sessionStorage.removeItem("lessonId"),sessionStorage.removeItem("moduleId"),sessionStorage.removeItem("lessonTitle"),a(!0),setTimeout(()=>c(-1),410)},[]),m=n.useCallback(()=>{a(!0),setTimeout(()=>e.closeBk(),350)},[]);return s("div",{className:`exit_message__blackdrop ${t&&"exit_message__blackdrop--close"}`,children:i("div",{className:"exit_message__box flex-column--centered",children:[s("div",{className:"btn_exit_ctn",children:s("div",{className:"btn_exit",onClick:m,children:" × "})}),s("h3",{children:" Sigur dorești să închizi lecția ? "}),i("div",{className:"flex-row--centered",children:[s("div",{className:"btn btn--white lesson-btn",onClick:l,children:" Da "}),s("div",{className:"btn btn--blue lesson-btn",onClick:m,children:" Nu "})]})]})})}function Y(){const[e,t]=n.useState(!1);return i(b,{children:[e&&s(Q,{closeBk:()=>t(!1)}),s("div",{className:"lesson__exit",children:s("button",{className:"lesson__exit__btn",onClick:()=>{t(!0)},children:"×"})})]})}function Z(e,t){const a=n.useRef(null);return n.useImperativeHandle(t,()=>({trigger:()=>{a.current.classList.add("lesson-transition--animated")}}),[]),s("div",{className:"lesson-transition",onAnimationEnd:()=>{a.current.classList.remove("lesson-transition--animated")},ref:a})}const p=n.forwardRef(Z);function re(){const[e,t]=n.useState({lessonId:-1,moduleId:-1,lessonTitle:""}),[a,c]=n.useState(0),l=_(),m=n.useRef({trigger:()=>{}});n.useEffect(()=>{const o=sessionStorage.getItem("lessonId"),u=sessionStorage.getItem("moduleId"),f=sessionStorage.getItem("lessonTitle");o&&u&&f?t({lessonId:+o,moduleId:+u,lessonTitle:f}):l("/Licenta/PageNotFound")},[]);const d=n.useCallback(o=>{o>=0&&o<=100&&c(o)},[]),r=n.useCallback(()=>{m.current.trigger()},[]);return i("section",{className:"lesson-section",children:[i("div",{className:"lesson-ctn",children:[e.lessonId>=0&&s(K,{...e,setProgressBar:d,triggerTransition:r}),s(p,{ref:m})]}),s("div",{className:"lesson__progress-bar",children:s(O,{progressStatus:a})}),s(Y,{})]})}export{re as default};
