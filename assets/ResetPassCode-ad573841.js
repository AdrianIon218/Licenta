import{r as i,j as f,u as T,e as _,F as S,a as t}from"./index-6a62bcfa.js";import{a as u,N as v}from"./Notfication-3afa7cdc.js";function E(a){const[s,p]=i.useState({min:10,sec:0}),h=(r,o,c)=>{const e=r*60*60*1e3,n=o*60*1e3,d=c*1e3;return e+n+d};return i.useEffect(()=>{const r=a.time.split(":"),o=h(+r[0],+r[1],+r[2]),c=setInterval(()=>{const e=new Date,n=e.getHours()>12?e.getHours()-12:e.getHours(),d=h(n,e.getMinutes(),e.getSeconds()),m=o-d;m<0?(a.codeExpire(),clearInterval(c)):p({min:Math.floor(m/1e3/60),sec:m/1e3%60})},1e3);return()=>{clearInterval(c)}},[a.time]),f("span",{style:{color:"red"},children:[s.min," min ",s.sec," sec"]})}function C(){const a=T(),[s,p]=i.useState(""),[h,r]=i.useState(""),[o,c]=i.useState(!1),[e,n]=i.useState({isShown:!1,messsage:"",type:u.NO_TYPE}),d=i.useRef(null);i.useEffect(()=>{const l=sessionStorage.getItem("emailToReset");if(!l){a("/Licenta/password_reset");return}p(l),sessionStorage.getItem("allowToResetPass")&&a("/Licenta/password_reset/new_password")},[]),i.useEffect(()=>{s&&_.post("http://localhost:5000/login/get_code_expire_time",{email:s}).then(l=>{const{status:g}=l.data;if(g){const{expire_at:w}=l.data;r(w)}else c(!0)})},[s]);const m=l=>{if(l.preventDefault(),o)a("/Licenta/login");else{const g=d.current.value;_.post("http://localhost:5000/login/verify_code_reset",{email:s,enteredCode:g}).then(w=>{const{status:x,isCorrect:N}=w.data;N?(sessionStorage.setItem("allowToResetPass","true"),a("/Licenta/password_reset/new_password")):n(x?{isShown:!0,messsage:"Codul este incorect !",type:u.WARNING}:{isShown:!0,messsage:"Eroare, încercați mai târziu !",type:u.ERROR})}).catch(()=>{n({isShown:!0,messsage:"Eroare, încercați mai târziu !",type:u.ERROR})})}};return f(S,{children:[e.isShown&&t(v,{message:e.messsage,type:e.type,deleteNotification:()=>{n({isShown:!1,messsage:"",type:u.NO_TYPE})}}),t("section",{className:"section-gradient section-header u_padding_down--big",children:t("div",{className:"flex-row--centered",children:t("div",{className:"box-mountain-bg",children:t("div",{className:"box-mountain-bg__form",children:f("form",{className:"forn",children:[f("div",{className:"u-center-text u-margin-bottom-medium",children:[t("h2",{className:"heading-secondary",style:{textTransform:"none"},children:o?`Codul trimis la ${s} a expirat!`:`Introduceți codul trimis la adresa ${s}`}),f("p",{style:{fontSize:"1rem",fontWeight:800},hidden:o,children:["Codul expiră în  ",t(E,{time:h,codeExpire:()=>c(!0)})]})]}),t("div",{className:"form__group u-margin-bottom-intermediate",hidden:o,children:t("input",{type:"password",className:"form__input u-center-text",placeholder:"Cod de resetare",id:"password",name:"password",minLength:6,maxLength:6,required:!0,ref:d})}),t("div",{className:"form__group",children:t("button",{className:"btn btn--white",onClick:m,children:o?"Înapoi la autentificare":"Verifică codul"})})]})})})})})]})}export{C as default};
