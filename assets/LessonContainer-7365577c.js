import{j as f,a as s,r as t,V as b,F as w,_ as R,u as k}from"./index-b48ae9aa.js";import{a as P}from"./axios-707ed124.js";import{N as A,a as M}from"./Notfication-08e1d09c.js";function H({progressStatus:e}){return f("div",{className:"progress-bar__box",children:[s("div",{className:"progress-bar__loading",style:{width:`${e}%`}}),s("div",{className:"progress-bar__grid-half"})]})}function I(e){const[n,o]=t.useState(0),a=t.useContext(b),c=e.sentence.length,d=c<8?c*190:c>20?c*120:c*170;return s("button",{className:"play-btn",onClick:()=>{o(r=>r===0?(a==null||a.readTextWithVoice(e.sentence),setTimeout(()=>{o(0)},d),1):r)},children:s("i",{className:`${n===0?"fa fa-play":"fa fa-pause"}`})})}function h(e){const n=t.useRef(null),[o,a]=t.useState(!1),c=d=>{var i;o||((i=n.current)==null||i.classList.add("word__container--fade-out"),setTimeout(()=>d(),300),a(!0))};return f("div",{className:"flex-column--centered word__container",ref:n,children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h3",{className:"u-center-text",children:e.wordName}),f("h4",{className:"u-center-text",children:["[ ",e.translation," ]"]}),f("h5",{className:"u-center-text",children:["Ex : ",e.example," "]}),s(I,{sentence:e.wordName}),f("div",{className:"arrow-ctn",children:[e.previousWord!==void 0&&s("i",{className:"fas fa-chevron-circle-left",onClick:()=>c(e.previousWord)}),e.nextWord!==void 0&&s("i",{className:"fas fa-chevron-circle-right arrow-right",onClick:()=>c(e.nextWord)})]})]})}function U(e){const[n,o]=t.useState(0),a=e.unkwonWords.length,[c,d]=t.useState(0);t.useEffect(()=>{e.setProgressBar(c)},[c]);const i=u=>{d(m=>m+50/a),o(u)},r=u=>{d(m=>m-50/a),o(u)},l=()=>{d(u=>u+50/a),e.toExecises()},g=t.useMemo(()=>e.unkwonWords.map((u,m)=>m===0?t.createElement(h,{...u,key:m,nextWord:()=>i(m+1)}):m===a-1?t.createElement(h,{...u,key:m,previousWord:()=>r(m-1),nextWord:l}):t.createElement(h,{...u,key:m,previousWord:()=>r(m-1),nextWord:()=>i(m+1)})),[e.unkwonWords]);return s("div",{children:g[n]})}function V(e){return t.useContext(b),s("div",{})}const j=/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g;function _(e){let n=e.replace(j,"");return n=n.replace(/\s+/g," ").trim(),n}function v(e){const n=t.useRef(null),o=_(e.wordName.toLowerCase()),a=i=>{i.preventDefault(),_(n.current.value.toLowerCase())===o?e.correctAnswear():(n.current.value="",e.wrongAnswear())},c=i=>{n.current.value.length<o.length&&(n.current.value+=i)},d=t.useMemo(()=>["ä","ö","ü","ß"].map((i,r)=>s("button",{type:"button",onClick:()=>c(i),children:i},r)),[]);return f(w,{children:[f("div",{className:"info",children:[s("i",{className:"fa fa-lightbulb-o"}),s("span",{children:"Nu este nevoie să folosești semne de punctuație"})]}),f("div",{className:"flex-column--centered word__container",children:[s("img",{className:"flex-element word__img",src:e.imageURL,alt:e.wordName}),s("h4",{className:"u-center-text",children:e.translation}),s(I,{sentence:e.example}),f("form",{onSubmit:a,className:"flex-column--centered write_word__form",children:[s("input",{type:"text",className:"flex-element u-center-text",maxLength:o.length,ref:n}),s("div",{className:"flex-element u-center-text umlouts-ctn ",children:d}),f("button",{className:"submitBtn u-center-text",children:["Verfică ",s("i",{className:"fas fa-angle-double-right"})]})]})]})]})}function F(e){const[n,o]=t.useReducer(d,{progressBar:50,score:0,wordIndex:0}),[a,c]=t.useState(!1);function d(r,l){const g=50/e.unkwonWords.length;switch(l.type){case 0:return e.setProgressBar(r.progressBar+g),{progressBar:r.progressBar+g,score:r.score+1,wordIndex:r.wordIndex+1};case 1:return{...r,score:r.score-1};default:return r}}t.useEffect(()=>{e.unkwonWords.sort((r,l)=>.5-Math.random())},[]);const i=t.useMemo(()=>e.unkwonWords.map((r,l)=>l%3===1?s(v,{...r,correctAnswear:()=>o({type:0}),wrongAnswear:()=>{o({type:1}),c(!0)}},l):s(v,{...r,correctAnswear:()=>o({type:0}),wrongAnswear:()=>{o({type:1}),c(!0)}},l)),[e.unkwonWords]);return t.useEffect(()=>{n.wordIndex===e.unkwonWords.length&&e.onFinish()},[n.wordIndex]),f("div",{className:"new_words_ex",children:[a&&s(A,{message:"Răspuns greșit !",type:M.ERROR,deleteNotification:()=>c(!1)}),n.wordIndex<e.unkwonWords.length&&i[n.wordIndex]]})}const O=t.lazy(()=>R(()=>import("./StartView-f66ed09c.js"),["assets/StartView-f66ed09c.js","assets/index-b48ae9aa.js","assets/index-5d8fcacc.css"]));function $(e){const[n,o]=t.useState(0),[a,c]=t.useState([]),[d,i]=t.useState(),r=sessionStorage.getItem("lessonType"),l=u=>{e.triggerTransition(),setTimeout(()=>o(u),450)},g=u=>{const m=[];return P.post("http://localhost:5000/lessons/getWords",{moduleId:u}).then(x=>(x.data.forEach(N=>{const{id:W,word:S,translation:E,example:C,moduleId:T}=N,y=new Uint8Array(N.image.data),L=new Blob([y],{type:"application/octet-stream"}),B=URL.createObjectURL(L);m.push({id:W,wordName:S.trim(),translation:E.trim(),example:C,moduleId:T,imageURL:B})}),m))};return t.useEffect(()=>{(r==="new_words"||r==="pronunciation"||r==="test")&&g(e.moduleId).then(u=>{u.sort((m,x)=>.5-Math.random()),c(u)})},[e.moduleId]),t.useEffect(()=>{if(r==="new_words"){i(s(U,{toExecises:()=>l(2),unkwonWords:a,setProgressBar:e.setProgressBar}));return}if(r==="pronunciation"){i(s(V,{toExecises:()=>l(2),unkwonWords:a}));return}},[a]),t.useEffect(()=>{n===2&&i(s(F,{unkwonWords:a,setProgressBar:e.setProgressBar,onFinish:()=>l(3)})),n===3&&i(s("div",{children:"Finished"}))},[n]),f(w,{children:[n===0&&s(O,{title:e.lessonTitle,startClickHandler:()=>l(1)}),(n===1||n===2||n===3)&&d]})}function D(e){const[n,o]=t.useState(!1),a=k(),c=t.useCallback(()=>{sessionStorage.setItem("lessonId",""),sessionStorage.setItem("moduleId",""),sessionStorage.setItem("lessonTitle",""),o(!0),setTimeout(()=>a(-1),410)},[]),d=t.useCallback(()=>{o(!0),setTimeout(()=>e.closeBk(),350)},[]);return s("div",{className:`exit_message__blackdrop ${n&&"exit_message__blackdrop--close"}`,children:f("div",{className:"exit_message__box flex-column--centered",children:[s("div",{className:"btn_exit_ctn",children:s("div",{className:"btn_exit",onClick:d,children:" × "})}),s("h3",{children:" Sigur dorești să închizi lecția ? "}),f("div",{className:"flex-row--centered",children:[s("div",{className:"btn btn--white lesson-btn",onClick:c,children:" Da "}),s("div",{className:"btn btn--blue lesson-btn",onClick:d,children:" Nu "})]})]})})}function J(){const[e,n]=t.useState(!1);return f(w,{children:[e&&s(D,{closeBk:()=>n(!1)}),s("div",{className:"lesson__exit",children:s("button",{className:"lesson__exit__btn",onClick:()=>{n(!0)},children:"×"})})]})}function X(e,n){const o=t.useRef(null);return t.useImperativeHandle(n,()=>({trigger:()=>{o.current.classList.add("lesson-transition--animated")}}),[]),s("div",{className:"lesson-transition",onAnimationEnd:()=>{o.current.classList.remove("lesson-transition--animated")},ref:o})}const p=t.forwardRef(X);function K(){const[e,n]=t.useState({lessonId:-1,moduleId:-1,lessonTitle:""}),[o,a]=t.useState(0),c=k(),d=t.useRef({trigger:()=>{}});t.useEffect(()=>{const l=sessionStorage.getItem("lessonId"),g=sessionStorage.getItem("moduleId"),u=sessionStorage.getItem("lessonTitle");l&&g&&u?n({lessonId:+l,moduleId:+g,lessonTitle:u}):c("/Licenta/PageNotFound")},[]);const i=t.useCallback(l=>{l>=0&&l<=100&&a(l)},[]),r=t.useCallback(()=>{d.current.trigger()},[]);return f("section",{className:"lesson-section",children:[f("div",{className:"lesson-ctn",children:[e.lessonId>=0&&s($,{...e,setProgressBar:i,triggerTransition:r}),s(p,{ref:d})]}),s("div",{className:"lesson__progress-bar",children:s(H,{progressStatus:o})}),s(J,{})]})}export{K as default};
